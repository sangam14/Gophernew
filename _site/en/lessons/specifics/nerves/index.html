<!DOCTYPE HTML>



<html lang="en">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta name="description" content="The premier destination for learning and mastering Elixir">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="http://localhost:4000/en/lessons/specifics/nerves/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="Elixir School">
  <meta property="og:locale" content="en">
  <meta property="og:description" content="The premier destination for learning and mastering Elixir">
  <meta property="og:image" content="http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg">
  
  
    
    
    
    
      <link rel="alternate" hreflang="en" href="/en/lessons/specifics/nerves/" />
      <link rel="alternate" hreflang="x-default" href="/en/lessons/specifics/nerves/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="es" href="/es/lessons/specifics/nerves/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ja" href="/ja/lessons/specifics/nerves/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hans" href="/zh-hans/lessons/specifics/nerves/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hant" href="/zh-hant/lessons/specifics/nerves/" />
    
  

  <link rel="canonical" href="http://localhost:4000/en/lessons/specifics/nerves/">
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/assets/favicons/apple-touch-icon-06ad80501b5734bba0428ca0fc14fcbe45811a144914f7be78cdab3c3ea25458.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/assets/favicons/favicon-32x32-6e7b9eca57d29d185a5184e844c1372ce9da0a71f373f89b80ff11f120b01678.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/assets/favicons/favicon-16x16-789b56195138252cac40cf7f2425b6fcb4e71c3084abc8525781188781b958d3.png">
  <link rel="manifest" href="http://localhost:4000/manifest.json">
  <link rel="shortcut icon" href="http://localhost:4000/assets/favicons/favicon-8e1fdc2a44d6344b9871b3ecf53a803903891f82a602a3f59c65eda40f2b77b0.ico">
  <link rel="alternate" type="application/rss+xml" title="Elixir School" href="https://elixirschool.com/feed.xml" />
  <meta name="msapplication-config" content="http://localhost:4000/assets/favicons/browserconfig-e66282a6754e6899f9a53c6ebfe120749630242b741deb65f364abc297ccbc96.xml">
  <meta name="theme-color" content="#ffffff">

  
  
  <title>Nerves &middot; Elixir School</title>
  <!-- CSS -->
  <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="stylesheet" type="text/css" href="/assets/main-07a5a32c1a26652d2bb0e43b4c7ade37f20599a76cae3c1e871d3af53cff80b2.css">
  <!--[if lte IE 9]><link rel="stylesheet" type="text/css" href="/assets/ie9-0c07c3ea146a3dd5dce4effda97b3718824cab9c30149877c0e445edecfdee60.css"><![endif]-->
  <!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/assets/ie8-f0c85ce6ad95a6d33929cb969a44f41a5e96ecb22de55f55d0f3c83cfc0012fc.css"><![endif]-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>
  <script type="text/javascript">
    if ("serviceWorker" in navigator) {
      if (!navigator.serviceWorker.controller) {
        navigator.serviceWorker.register("http://localhost:4000/serviceworker.js", {
          scope: "http://localhost:4000"
        })
        .then(reg => console.log("Service worker has been registered for scope: ", reg.scope))
        .catch(error => console.log("Service worker registration has failed: ", error));
      }
    }  
  </script>
</head>

	<body class="is-loading">
    <script type="text/javascript">
    var $theme = localStorage.getItem('theme');
    if ($theme === 'dark') document.body.classList.add("dark");
    </script>
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
					  <a href="/en/" class="logo"><strong>Elixir School</strong></a>
					  <ul class="icons">
  
  <li><iframe src="https://ghbtns.com/github-btn.html?user=elixirschool&repo=elixirschool&type=star&count=true" height="20" title="GitHub Stars" width="93" style="vertical-align: sub;"></iframe></li>
  <li><a target="_blank" rel="noopener" title="RSS" href="https://elixirschool.com/feed.xml" class="icon fa-rss-square"><span class="label">RSS</span></a></li>
  <li><a target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/en/lessons/specifics/nerves/&title=Nerves&summary=description&source=http://localhost:4000" class="icon fa-linkedin"><span class="label">Linkedin</span></a></li>
  <li><a target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/intent/tweet?url=http://localhost:4000/en/lessons/specifics/nerves/&via=elixirschool&text=ElixirSchool: Nerves&hashtags=learnelixir%2Celixirlang&" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
  <li><a target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/en/lessons/specifics/nerves/" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
  <li><a target="_blank" rel="noopener" title="Pinterest" href="https://www.pinterest.com/pin/create/link/?url=http://localhost:4000/en/lessons/specifics/nerves/&media=http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg&description=ElixirSchool: Nerves" class="icon fa-pinterest"><span class="label">Pinterest</span></a></li>
  <li><a target="_blank" rel="noopener" title="VK" href="https://vk.com/share.php?url=http://localhost:4000/en/lessons/specifics/nerves/&title=ElixirSchool: Nerves&description=Check out 'Nerves' on ElixirSchool" class="icon fa-vk"><span class="label">VK</span></a></li>
  <li><a target="_blank" rel="noopener" title="Email" href="mailto:?to=&subject=ElixirSchool: Nerves&body=Check out 'Nerves' on ElixirSchool%0D%0A%0D%0Ahttp://localhost:4000/en/lessons/specifics/nerves/" class="icon fa-envelope"><span class="label">Email</span></a></li>
  <li><a title="Print" href="javascript:window.print()" class="icon fa-print"><span class="label">Print</span></a></li>
</ul>

					</header>
					<section id="section-page" class="ltr">
  <header class="main">
    
      <h1>Nerves</h1>
    
  </header>
  <div class="content">
    <h2>Table of Contents</h2>
<div id="toc"></div>

<h2 id="introduction-and-requirements">Introduction and requirements</h2>

<p>We will be talking about Nerves in this lesson. The Nerves project is a framework for using Elixir in embedded software development. As the website for Nerves says, it allows you to “craft and deploy bulletproof embedded software in Elixir”. This lesson will be a bit different from other Elixir School lessons. Nerves is a bit more difficult to get into as it requires both some advanced system setup and additional hardware, so may not be suitable for beginners.</p>

<p>To write embedded code using Nerves, you will need one of the <a href="https://hexdocs.pm/nerves/targets.html">supported targets</a>, a card reader with a memory card supported by the hardware of your choice, as well as wired networking connection to access this device by the network.</p>

<p>However, we would suggest using a Raspberry Pi, due to it having controllable LED onboard. It is also advisable to have a screen connected to your target device as this will simplify debugging using IEx.</p>

<h2 id="setup">Setup</h2>

<p>The Nerves project itself has an excellent <a href="https://hexdocs.pm/nerves/getting-started.html">Getting started guide</a>, but the amount of detail there may be overwhelming for some users. Instead, this tutorial will try and present “fewer words, more code”.</p>

<p>Firstly, you will need an environment set up. You can find the guide in the <a href="https://hexdocs.pm/nerves/installation.html">Installation</a> part of Nerves wiki. Please make sure that you have the same version of both OTP and Elixir mentioned in the guide. Not using the right version can cause trouble as you progress. At the time of writing, any Elixir (compiled with Erlang/OTP 21) should work.</p>

<p>After getting set up, you should be ready to build your first Nerves project!</p>

<p>Our goal will be getting to the “Hello world” of embedded development: a blinking LED controlled by calling a simple HTTP API.</p>

<h2 id="creating-a-project">Creating a project</h2>

<p>To generate a new project, run <code class="highlighter-rouge">mix nerves.new network_led</code> and answer <code class="highlighter-rouge">Y</code> when prompted whether to fetch and install dependencies.</p>

<p>You should get the following output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Your Nerves project was created successfully.

You should now pick a target. See https://hexdocs.pm/nerves/targets.html#content
for supported targets. If your target is on the list, set `MIX_TARGET`
to its tag name:

For example, for the Raspberry Pi 3 you can either
  $ export MIX_TARGET=rpi3
Or prefix `mix` commands like the following:
  $ MIX_TARGET=rpi3 mix firmware

If you will be using a custom system, update the `mix.exs`
dependencies to point to desired system's package.

Now download the dependencies and build a firmware archive:
  $ cd network_led
  $ mix deps.get
  $ mix firmware

If your target boots up using an SDCard (like the Raspberry Pi 3),
then insert an SDCard into a reader on your computer and run:
  $ mix firmware.burn

Plug the SDCard into the target and power it up. See target documentation
above for more information and other targets.
</code></pre></div></div>

<p>Our project has been generated and is ready to be flashed to our test device! Let’s try it now!</p>

<p>In the case of a Raspberry Pi 3, you set <code class="highlighter-rouge">MIX_TARGET=rpi3</code>, but you can change this to suit the hardware you have depending on the target hardware (see the list in the <a href="https://hexdocs.pm/nerves/targets.html#content">Nerves documentation</a>).</p>

<p>Let’s set up our dependencies first:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ export MIX_TARGET=rpi3
$ cd network_led
$ mix deps.get

....

Nerves environment
  MIX_TARGET:   rpi3
  MIX_ENV:      dev
Resolving Nerves artifacts...
  Resolving nerves_system_rpi3
  =&gt; Trying https://github.com/nerves-project/nerves_system_rpi3/releases/download/v1.12.2/nerves_system_rpi3-portable-1.12.2-E904717.tar.gz
|==================================================| 100% (142 / 142) MB
  =&gt; Success
  Resolving nerves_toolchain_arm_unknown_linux_gnueabihf
  =&gt; Trying https://github.com/nerves-project/toolchains/releases/download/v1.3.2/nerves_toolchain_arm_unknown_linux_gnueabihf-darwin_x86_64-1.3.2-E31F29C.tar.xz
|==================================================| 100% (55 / 55) MB
  =&gt; Success
</code></pre></div></div>

<p>Note: be sure you have set the environment variable specifying the target platform before running <code class="highlighter-rouge">mix deps.get</code>, as it will download the appropriate system image and toolchain for the specified platform.</p>

<h2 id="burning-the-firmware">Burning the firmware</h2>

<p>Now we can proceed to flashing the drive. Put the card into the reader, and if you set up everything correctly in previous steps, after running <code class="highlighter-rouge">mix firmware.burn</code> and confirming the device to use you should get this prompt:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Building ......../network_led/_build/rpi_dev/nerves/images/network_led.fw...
Use 7.42 GiB memory card found at /dev/rdisk2? [Yn]
</code></pre></div></div>

<p>If you are sure this is the card you want to burn - pick <code class="highlighter-rouge">Y</code> and after some time the memory card is ready:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Use 7.42 GiB memory card found at /dev/rdisk2? [Yn]
|====================================| 100% (32.51 / 32.51) MB
Success!
Elapsed time: 8.022 s
</code></pre></div></div>

<p>Now it is time to put the memory card into your device and verify whether it works.</p>

<p>If you have a screen connected - you should see a Linux boot sequence on it after powering up the device with this memory card inserted.</p>

<h2 id="setting-up-networking">Setting up networking</h2>

<p>The next step is to set up the network. The Nerves ecosystem provides a variety of packages, and <a href="https://github.com/nerves-networking/vintage_net">vintage_net</a> is what we will need to connect the device to the network over the wired Ethernet port.</p>

<p>It is already present in your project as a dependency of <a href="https://github.com/nerves-project/nerves_pack"><code class="highlighter-rouge">nerves_pack</code></a>. However, by default, it uses DHCP (see the configuration for it in <code class="highlighter-rouge">config/target.exs</code> after <code class="highlighter-rouge">config :vintage_net</code>). It is easier to have a static IP address.</p>

<p>To set up static networking on the wired Ethernet port, you need to update the <code class="highlighter-rouge">:vintage_net</code> configuration in <code class="highlighter-rouge">config/target.exs</code> as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Statically assign an address</span>
<span class="n">config</span> <span class="ss">:vintage_net</span><span class="p">,</span>
  <span class="ss">regulatory_domain:</span> <span class="s2">"US"</span><span class="p">,</span>
  <span class="ss">config:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"usb0"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">type:</span> <span class="no">VintageNetDirect</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">"eth0"</span><span class="p">,</span>
     <span class="p">%{</span>
       <span class="ss">type:</span> <span class="no">VintageNetEthernet</span><span class="p">,</span>
       <span class="ss">ipv4:</span> <span class="p">%{</span>
         <span class="ss">method:</span> <span class="ss">:static</span><span class="p">,</span>
         <span class="ss">address:</span> <span class="s2">"192.168.88.2"</span><span class="p">,</span>
         <span class="ss">prefix_length:</span> <span class="mi">24</span><span class="p">,</span>
         <span class="ss">gateway:</span> <span class="s2">"192.168.88.1"</span><span class="p">,</span>
         <span class="ss">name_servers:</span> <span class="p">[</span><span class="s2">"8.8.8.8"</span><span class="p">,</span> <span class="s2">"8.8.4.4"</span><span class="p">]</span>
       <span class="p">}</span>
     <span class="p">}},</span>
    <span class="p">{</span><span class="s2">"wlan0"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">type:</span> <span class="no">VintageNetWiFi</span><span class="p">}}</span>
  <span class="p">]</span>
</code></pre></div></div>

<p>Please note that this configuration only updates the wired Ethernet port. If you want to use the wireless connection - take a look at the <a href="https://hexdocs.pm/vintage_net/cookbook.html#wifi">VintageNet Cookbook</a>.</p>

<p>Note that you need to use your local network parameters here - in my network there is an unallocated IP <code class="highlighter-rouge">192.168.88.2</code>, which I am going to use. However, in your case, it may differ.</p>

<p>After changing this, we will need to burn the changed version of the firmware via <code class="highlighter-rouge">mix firmware.burn</code>, then start up the device with the new card.</p>

<p>When you power up the device, you can use <code class="highlighter-rouge">ping</code> to see it coming online.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Request timeout for icmp_seq 206
Request timeout for icmp_seq 207
64 bytes from 192.168.88.2: icmp_seq=208 ttl=64 time=2.247 ms
64 bytes from 192.168.88.2: icmp_seq=209 ttl=64 time=2.658 ms
</code></pre></div></div>

<p>This output means that the device now is reachable from the network.</p>

<h2 id="network-firmware-burning">Network firmware burning</h2>

<p>So far, we have been burning SD cards and physically load them into our hardware. While this is fine to start with, it is more straightforward to push our updates over the network. The <a href="https://github.com/nerves-project/ssh_subsystem_fwup"><code class="highlighter-rouge">ssh_subsystem_fwup</code></a> package does just that. It is already present in your project by default and is configured to auto-detect and find SSH keys in your <code class="highlighter-rouge">~/.ssh</code> directory.</p>

<p>To use the network firmware update functionality, you will need to generate an upload script via  <code class="highlighter-rouge">mix firmware.gen.script</code>. This command will generate a new <code class="highlighter-rouge">upload.sh</code> script which we can run to update the firmware.</p>

<p>If the network is functional after the previous step, you are good to go.</p>

<p>To update your setup, the simplest way is to use <code class="highlighter-rouge">mix firmware &amp;&amp; ./upload.sh 192.168.88.2</code>: the first command creates the updated firmware, and the second one pushes it over the network and reboots the device. You can finally stop having to swap SD cards in and out of the device!</p>

<p><em>Hint: <code class="highlighter-rouge">ssh 192.168.88.2</code> gives you an IEx shell on the device in the context of the app.</em></p>

<p><em>Troubleshooting: If you don’t have an existing ssh key in your home folder, you will have an error <code class="highlighter-rouge">No SSH public keys found in ~/.ssh.</code>. In this case, you will need to run <code class="highlighter-rouge">ssh-keygen</code> and re-burn the firmware to use the network update feature.</em></p>

<h2 id="setting-up-the-led-control">Setting up the LED control</h2>

<p>To interact with LEDs, you need <a href="https://github.com/nerves-project/nerves_leds">nerves_leds</a> package installed which is done by adding <code class="highlighter-rouge">{:nerves_leds, "~&gt; 0.8", targets: @all_targets},</code> to <code class="highlighter-rouge">mix.exs</code> file.</p>

<p>After setting up the dependency, you need to configure the LED list for the given device. For example, for all Raspberry Pi models, there is only one LED onboard: <code class="highlighter-rouge">led0</code>. Let’s use it by adding a <code class="highlighter-rouge">config :nerves_leds, names: [green: "led0"]</code> line to the <code class="highlighter-rouge">config/config.exs</code>.</p>

<p>For other devices, you can take a look at the <a href="https://github.com/nerves-project/nerves_examples/tree/main/hello_leds/config">corresponding part of the nerves_examples project</a>.</p>

<p>After configuring the LED itself, we surely need to control it somehow. To do that, we will add a GenServer (see details about GenServers in <a href="../../advanced/otp-concurrency">OTP Concurrency</a> lesson) in <code class="highlighter-rouge">lib/network_led/blinker.ex</code> with these contents:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">NetworkLed</span><span class="o">.</span><span class="no">Blinker</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenServer</span>

  <span class="nv">@moduledoc</span> <span class="sd">"""
    Simple GenServer to control GPIO #18.
  """</span>

  <span class="kn">require</span> <span class="no">Logger</span>
  <span class="n">alias</span> <span class="no">Nerves</span><span class="o">.</span><span class="no">Leds</span>

  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">state</span> <span class="p">\\</span> <span class="p">[])</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="ss">name:</span> <span class="bp">__MODULE__</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">enable</span><span class="p">()</span>

    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_cast</span><span class="p">(</span><span class="ss">:enable</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Enabling LED"</span><span class="p">)</span>
    <span class="no">Leds</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">green:</span> <span class="no">true</span><span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_cast</span><span class="p">(</span><span class="ss">:disable</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Disabling LED"</span><span class="p">)</span>
    <span class="no">Leds</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">green:</span> <span class="no">false</span><span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">enable</span><span class="p">()</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:enable</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">disable</span><span class="p">()</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:disable</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>To enable this, you also need to add it to the supervision tree in <code class="highlighter-rouge">lib/network_led/application.ex</code>: add <code class="highlighter-rouge">{NetworkLed.Blinker, name: NetworkLed.Blinker}</code> under the <code class="highlighter-rouge">def children(_target) do</code> group.</p>

<p>Notice that Nerves has two different supervision trees in application - one for the host machine and one for actual devices.</p>

<p>After this - that’s it! You actually can upload the firmware and via running IEx through ssh on target device check that <code class="highlighter-rouge">NetworkLed.Blinker.disable()</code> turns the LED off (which is enabled by default in code), and <code class="highlighter-rouge">NetworkLed.Blinker.enable()</code> turns it on.</p>

<p>We have control over the LED from the command prompt!</p>

<p>Now the only missing piece of the puzzle left is to control the LED via the web interface.</p>

<h2 id="adding-the-web-server">Adding the web server</h2>

<p>In this step, we will be using <code class="highlighter-rouge">Plug.Router</code>. If you need a reminder - feel free to skim through the <a href="../../../lessons/specifics/plug/">Plug</a> lesson.</p>

<p>First, we will add <code class="highlighter-rouge">{:plug_cowboy, "~&gt; 2.0"},</code> to <code class="highlighter-rouge">mix.exs</code> and install the dependencies.</p>

<p>Then, add the actual process to process those requests in <code class="highlighter-rouge">lib/network_led/http.ex</code> :</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">NetworkLed</span><span class="o">.</span><span class="no">Http</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Router</span>

  <span class="n">plug</span><span class="p">(</span><span class="ss">:match</span><span class="p">)</span>
  <span class="n">plug</span><span class="p">(</span><span class="ss">:dispatch</span><span class="p">)</span>

  <span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"Feel free to use API endpoints!"</span><span class="p">))</span>

  <span class="n">get</span> <span class="s2">"/enable"</span> <span class="k">do</span>
    <span class="no">NetworkLed</span><span class="o">.</span><span class="no">Blinker</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
    <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"LED enabled"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">get</span> <span class="s2">"/disable"</span> <span class="k">do</span>
    <span class="no">NetworkLed</span><span class="o">.</span><span class="no">Blinker</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"LED disabled"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">match</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">"Oops!"</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And, the final step - add <code class="highlighter-rouge">{Plug.Cowboy, scheme: :http, plug: NetworkLed.Http, options: [port: 80]}</code> to the application supervision tree.</p>

<p>After the firmware update, you can try it! <code class="highlighter-rouge">http://192.168.88.2/</code> is returning plain text response, and <code class="highlighter-rouge">http://192.168.88.2/enable</code> with <code class="highlighter-rouge">http://192.168.88.2/disable</code> disable and enable that LED!</p>

<p>You can even pack Phoenix-powered user interfaces into your Nerves app, however, it <a href="https://github.com/nerves-project/nerves/blob/master/docs/User%20Interfaces.md#phoenix-web-interfaces">will require some tweaking</a>.</p>

    
    <blockquote class="edit-lesson">    
      Caught a mistake or want to contribute to the lesson?
      <a href="https://github.com/elixirschool/elixirschool/edit/master/en/lessons/specifics/nerves.md" target="_blank" rel="noopener">
        Edit this page on GitHub!
      </a>
    </blockquote>
  </div>
</section>



<section>

<div class="row">
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/en/lessons/specifics/debugging/" title="Debugging">← Debugging</a>
    </div>
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/en/lessons/libraries/guardian/" title="Guardian (Basics)">Guardian (Basics) →</a>
    </div>
    
</div>
</section>




				</div>
			</div>
			<!-- Sidebar -->
  <div id="sidebar">
    <p class="toggle-theme-wrapper"><a rel="noopener" href="#toggle-theme" class="toggle-theme icon fas fa-circle-o" alt="Toggle Theme" title="Toggle Theme"></a></p>

    <div class="inner">
      
<!-- Locales Section -->
<section id="search" class="alt">
  <div id="locales">

      
        
        

        
          <strong title="English">en</strong>
        
      
        
        

        
          <a href="/es/lessons/specifics/nerves/" title="Spanish / Español">es</a>
        
      
        
        

        
          <a href="/ja/lessons/specifics/nerves/" title="Japanese / 日本語">ja</a>
        
      
        
        

        
          <a href="/zh-hans/lessons/specifics/nerves/" title="Chinese">zh-hans</a>
        
      
        
        

        
          <a href="/zh-hant/lessons/specifics/nerves/" title="Traditional Chinese">zh-hant</a>
        
      

  </div>
</section>


      
<!-- Menu -->
<nav id="menu">
  <span class="stack-info otp-version">Elixir 1.10.1 - Erlang/OTP 22.0 [erts-10.5.3]</span>
  <header class="major">
    <h2>Menu</h2>
    <p>The premier destination for learning and mastering Elixir</p>
  </header>
  <ul>
    <li>
      <a href="/en/" class=" up ">Home</a>
    </li>
  
    
    
    
    
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Basics</span>
          <ul>
        
            <li>
              
              <a href="/en/lessons/basics/basics/">1. Basics</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/collections/">2. Collections</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/enum/">3. Enum</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/pattern-matching/">4. Pattern Matching</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/control-structures/">5. Control Structures</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/functions/">6. Functions</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/pipe-operator/">7. Pipe Operator</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/modules/">8. Modules</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/mix/">9. Mix</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/sigils/">10. Sigils</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/documentation/">11. Documentation</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/testing/">12. Testing</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/comprehensions/">13. Comprehensions</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/strings/">14. Strings</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/date-time/">15. Date and Time</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/mix-tasks/">16. Custom Mix Tasks</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/basics/iex-helpers/">17. IEx Helpers</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Advanced</span>
          <ul>
        
            <li>
              
              <a href="/en/lessons/advanced/erlang/">1. Erlang Interoperability</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/error-handling/">2. Error Handling</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/escripts/">3. Executables</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/concurrency/">4. Concurrency</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/otp-concurrency/">5. OTP Concurrency</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/otp-supervisors/">6. OTP Supervisors</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/otp-distribution/">7. OTP Distribution</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/metaprogramming/">8. Metaprogramming</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/umbrella-projects/">9. Umbrella Projects</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/typespec/">10. Specifications and types</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/behaviours/">11. Behaviours</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/gen-stage/">12. GenStage</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/advanced/protocols/">13. Protocols</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Ecto</span>
          <ul>
        
            <li>
              
              <a href="/en/lessons/ecto/basics/">1. Basics</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/ecto/changesets/">2. Changesets</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/ecto/associations/">3. Associations</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/ecto/querying/">4. Querying</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener active up">Specifics</span>
          <ul>
        
            <li>
              
              <a href="/en/lessons/specifics/plug/">1. Plug</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/specifics/eex/">2. Embedded Elixir (EEx)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/specifics/ets/">3. Erlang Term Storage (ETS)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/specifics/mnesia/">4. Mnesia</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/specifics/debugging/">5. Debugging</a>
              
            </li>
        
      
        
            <li>
              
              <span class="active">6. Nerves</span>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Libraries</span>
          <ul>
        
            <li>
              
              <a href="/en/lessons/libraries/guardian/">1. Guardian (Basics)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/libraries/poolboy/">2. Poolboy</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/libraries/benchee/">3. Benchee</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/libraries/bypass/">4. Bypass</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/libraries/distillery/">5. Distillery (Basics)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/en/lessons/libraries/stream-data/">6. StreamData</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    <li>
      <a href="/blog/" class=" up ">Blog</a>
    </li>
    
    <li>
      <a href="/contributors/" class=" up ">Contributors</a>
    </li>
  </ul>
</nav>

      <!-- Footer -->
      <footer id="footer">
        <p class="copyright">&copy; 2021 <a target="_blank" rel="noopener" href="https://github.com/doomspork">Sean Callan</a> All rights reserved.</p>
      </footer>
    </div>
  </div>

		</div>
		<!-- Scripts -->

    <script async="" src="/assets/main-f8c201d2721dcb6d1d4f6acb0ebd2b2c192757ed29271f519513e4417e347611.js" type="text/javascript"></script>
		<!--[if lte IE 8]><script async="" src="/assets/ie/respond.min-8306093ccce666c01dab405fac0d16596a1d1cf38aa0ba919d4831261662cdbb.js" type="text/javascript"></script><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	</body>
</html>
