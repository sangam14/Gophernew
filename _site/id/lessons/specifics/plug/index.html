<!DOCTYPE HTML>



<html lang="id">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta name="description" content="Pelajaran mengenai bahasa pemrograman Elixir">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="http://localhost:4000/id/lessons/specifics/plug/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="Elixir School">
  <meta property="og:locale" content="id">
  <meta property="og:description" content="Pelajaran mengenai bahasa pemrograman Elixir">
  <meta property="og:image" content="http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg">
  
  
    
    
    
    
      <link rel="alternate" hreflang="en" href="/en/lessons/specifics/plug/" />
      <link rel="alternate" hreflang="x-default" href="/en/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="es" href="/es/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="el" href="/gr/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="id" href="/id/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ja" href="/ja/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ko" href="/ko/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pl" href="/pl/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pt" href="/pt/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ru" href="/ru/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="vi" href="/vi/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hans" href="/zh-hans/lessons/specifics/plug/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hant" href="/zh-hant/lessons/specifics/plug/" />
    
  

  <link rel="canonical" href="http://localhost:4000/id/lessons/specifics/plug/">
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/assets/favicons/apple-touch-icon-06ad80501b5734bba0428ca0fc14fcbe45811a144914f7be78cdab3c3ea25458.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/assets/favicons/favicon-32x32-6e7b9eca57d29d185a5184e844c1372ce9da0a71f373f89b80ff11f120b01678.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/assets/favicons/favicon-16x16-789b56195138252cac40cf7f2425b6fcb4e71c3084abc8525781188781b958d3.png">
  <link rel="manifest" href="http://localhost:4000/manifest.json">
  <link rel="shortcut icon" href="http://localhost:4000/assets/favicons/favicon-8e1fdc2a44d6344b9871b3ecf53a803903891f82a602a3f59c65eda40f2b77b0.ico">
  <link rel="alternate" type="application/rss+xml" title="Elixir School" href="https://elixirschool.com/feed.xml" />
  <meta name="msapplication-config" content="http://localhost:4000/assets/favicons/browserconfig-e66282a6754e6899f9a53c6ebfe120749630242b741deb65f364abc297ccbc96.xml">
  <meta name="theme-color" content="#ffffff">

  
  
  <title>Plug &middot; Elixir School</title>
  <!-- CSS -->
  <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="stylesheet" type="text/css" href="/assets/main-07a5a32c1a26652d2bb0e43b4c7ade37f20599a76cae3c1e871d3af53cff80b2.css">
  <!--[if lte IE 9]><link rel="stylesheet" type="text/css" href="/assets/ie9-0c07c3ea146a3dd5dce4effda97b3718824cab9c30149877c0e445edecfdee60.css"><![endif]-->
  <!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/assets/ie8-f0c85ce6ad95a6d33929cb969a44f41a5e96ecb22de55f55d0f3c83cfc0012fc.css"><![endif]-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>
  <script type="text/javascript">
    if ("serviceWorker" in navigator) {
      if (!navigator.serviceWorker.controller) {
        navigator.serviceWorker.register("http://localhost:4000/serviceworker.js", {
          scope: "http://localhost:4000"
        })
        .then(reg => console.log("Service worker has been registered for scope: ", reg.scope))
        .catch(error => console.log("Service worker registration has failed: ", error));
      }
    }  
  </script>
</head>

	<body class="is-loading">
    <script type="text/javascript">
    var $theme = localStorage.getItem('theme');
    if ($theme === 'dark') document.body.classList.add("dark");
    </script>
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
					  <a href="/id/" class="logo"><strong>Elixir School</strong></a>
					  <ul class="icons">
  
  <li><iframe src="https://ghbtns.com/github-btn.html?user=elixirschool&repo=elixirschool&type=star&count=true" height="20" title="GitHub Stars" width="93" style="vertical-align: sub;"></iframe></li>
  <li><a target="_blank" rel="noopener" title="RSS" href="https://elixirschool.com/feed.xml" class="icon fa-rss-square"><span class="label">RSS</span></a></li>
  <li><a target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/id/lessons/specifics/plug/&title=Plug&summary=description&source=http://localhost:4000" class="icon fa-linkedin"><span class="label">Linkedin</span></a></li>
  <li><a target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/intent/tweet?url=http://localhost:4000/id/lessons/specifics/plug/&via=elixirschool&text=ElixirSchool: Plug&hashtags=learnelixir%2Celixirlang&" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
  <li><a target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/id/lessons/specifics/plug/" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
  <li><a target="_blank" rel="noopener" title="Pinterest" href="https://www.pinterest.com/pin/create/link/?url=http://localhost:4000/id/lessons/specifics/plug/&media=http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg&description=ElixirSchool: Plug" class="icon fa-pinterest"><span class="label">Pinterest</span></a></li>
  <li><a target="_blank" rel="noopener" title="VK" href="https://vk.com/share.php?url=http://localhost:4000/id/lessons/specifics/plug/&title=ElixirSchool: Plug&description=Check out 'Plug' on ElixirSchool" class="icon fa-vk"><span class="label">VK</span></a></li>
  <li><a target="_blank" rel="noopener" title="Email" href="mailto:?to=&subject=ElixirSchool: Plug&body=Check out 'Plug' on ElixirSchool%0D%0A%0D%0Ahttp://localhost:4000/id/lessons/specifics/plug/" class="icon fa-envelope"><span class="label">Email</span></a></li>
  <li><a title="Print" href="javascript:window.print()" class="icon fa-print"><span class="label">Print</span></a></li>
</ul>

					</header>
					<section id="section-page" class="ltr">
  <header class="main">
    
    <h1 class="page-title">
  <span class="version-difference-indicator version-difference-major"></span>
  Plug
</h1>
<div class="version-info version-info-major">
  <span>
    
      Some contents of this translation may be outdated.<br/>
    

    Several major changes were applied to the original lesson since the last update.
  </span>
</div>

    
  </header>
  <div class="content">
    <p>Kalau anda familiar dengan Ruby anda bisa menganggap Plug seperti Rack dengan sedikit Sinatra.  Plug memberi spesifikasi untuk komponen aplikasi web dan adapter untuk web server. Walau bukan bagian Elixir core, Plug adalah sebuah project resmi Elixir.</p>

<h2>Daftar Isi</h2>
<div id="toc"></div>

<h2 id="instalasi">Instalasi</h2>

<p>Instalasi menggunakan Mix sangat mudah.  Untuk menginstal Plug kita perlu membuat dua perubahan kecil pada <code class="highlighter-rouge">mix.exs</code> kita.  Yang pertama perlu dilakukan adalah menambahkan Plug dan sebuah web server (kita akan pakai Cowboy) ke file kita sebagai dependensi:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[{</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="s2">"~&gt; 1.1.2"</span><span class="p">},</span> <span class="p">{</span><span class="ss">:plug</span><span class="p">,</span> <span class="s2">"~&gt; 1.3.4"</span><span class="p">}]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Yang terakhir kita perlu lakukan adalah menambahkan web server kita dan Plug ke aplikasi OTP kita:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span><span class="ss">applications:</span> <span class="p">[</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="ss">:logger</span><span class="p">,</span> <span class="ss">:plug</span><span class="p">]]</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="spesifikasi">Spesifikasi</h2>

<p>Untuk memulai membuat Plug, kita perlu tahu, dan menuruti, spesifikasi Plug.  Untungnya, hanya ada dua fungsi yang diperlukan: <code class="highlighter-rouge">init/1</code> dan <code class="highlighter-rouge">call/2</code>.</p>

<p>Fungsi <code class="highlighter-rouge">init/1</code> digunakan untuk menginisialisasi opsi-opsi Plug kita, yang dimasukan sebagai argumen kedua untuk fungsi <code class="highlighter-rouge">call/2</code> kita.  Di samping opsi inisialisasi itu fungsi <code class="highlighter-rouge">call/2</code> menerima sebuah <code class="highlighter-rouge">%Plug.Conn</code> sebagai argumen pertamanya dan mengembalikan sebuah connection.</p>

<p>Ini adalah sebuah Plug sederhana yang mengembalikan “Hello World!”:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">HelloWorldPlug</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Conn</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">options</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">options</span>

  <span class="k">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">conn</span>
    <span class="o">|&gt;</span> <span class="n">put_resp_content_type</span><span class="p">(</span><span class="s2">"text/plain"</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">send_resp</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">"Hello World!"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="membuat-sebuah-plug">Membuat sebuah Plug</h2>

<p>Untuk contoh ini kita akan membuat sebuah Plug untuk memverifikasi apakan request memiliki parameter yang dibutuhkan.  Dengan mengimplementasikan validasi kita dalam sebuah Plug kita bisa yakin bahwa request yang valid yang mencapai aplikasi kita.  Kita akan mempunyai ekspektasi bahwa Plug kita diinisialisasi dengan dua opsi: <code class="highlighter-rouge">:paths</code> dan <code class="highlighter-rouge">:fields</code>.  Kedua opsi ini akan merepresentasikan path yang akan kita terapkan logika kita atasnya dan field apa saja yang dibutuhkan.</p>

<p><em>Catatan</em>: Plug diterapkan pada semua request sehingga kita akan menerapkan logika kita hanya pada sebagian dari request tersebut.  Untuk mengabaikan sebuah request kita hanya akan meneruskannya.</p>

<p>Kita akan mulai dengan melihat pada Plug kita yang sudah jadi dan kemudian mendiskusikan bagaimana ia bekerja.  Kita akan membuatnya di <code class="highlighter-rouge">lib/example/plug/verify_request.ex</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">VerifyRequest</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Conn</span>

  <span class="k">defmodule</span> <span class="no">IncompleteRequestError</span> <span class="k">do</span>
    <span class="nv">@moduledoc</span> <span class="sd">"""
    Error raised when a required field is missing.
    """</span>

    <span class="k">defexception</span> <span class="ss">message:</span> <span class="s2">""</span><span class="p">,</span> <span class="ss">plug_status:</span> <span class="mi">400</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">options</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">options</span>

  <span class="k">def</span> <span class="n">call</span><span class="p">(%</span><span class="no">Plug</span><span class="o">.</span><span class="no">Conn</span><span class="p">{</span><span class="ss">request_path:</span> <span class="n">path</span><span class="p">}</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">[</span><span class="ss">:paths</span><span class="p">],</span> <span class="k">do</span><span class="p">:</span> <span class="n">verify_request!</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">body_params</span><span class="p">,</span> <span class="n">opts</span><span class="p">[</span><span class="ss">:fields</span><span class="p">])</span>
    <span class="n">conn</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">verify_request!</span><span class="p">(</span><span class="n">body_params</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">verified</span> <span class="o">=</span>
      <span class="n">body_params</span>
      <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
      <span class="o">|&gt;</span> <span class="n">contains_fields?</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">unless</span> <span class="n">verified</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="k">raise</span><span class="p">(</span><span class="no">IncompleteRequestError</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">contains_fields?</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">fields</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="no">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Hal pertama yang perlu dicatat adalah bahwa kita telah mendefinisikan sebuah exception baru <code class="highlighter-rouge">IncompleteRequestError</code> dan bahwa salah satu opsinya adalah <code class="highlighter-rouge">:plug_status</code>.  Jika tersedia opsi ini digunakan oleh Plug untuk menset kode status HTTP jika terjadi exception.</p>

<p>Bagian kedua dari Plug kita adalah fungsi <code class="highlighter-rouge">call/2</code>.  Di sinilah kita memutuskan apakah akan menerapkan logika verifikasi kita atau tidak.  Hanya jika path dari request tersebut ada dalam opsi <code class="highlighter-rouge">:paths</code> kita sajalah kita akan memanggil <code class="highlighter-rouge">verify_request!/2</code>.</p>

<p>Bagian terakhir dari plug kita adalah fungsi privat <code class="highlighter-rouge">verify_request!/2</code> yang memverifikasi apakah <code class="highlighter-rouge">:fields</code> yang dibutuhkan semuanya ada.  Jika ada yang tidak ada, kita memunculkan exception <code class="highlighter-rouge">IncompleteRequestError</code>.</p>

<h2 id="menggunakan-plugrouter">Menggunakan Plug.Router</h2>

<p>Sekarang setelah kita memiliki plug <code class="highlighter-rouge">VerifyRequest</code> kita, kita bisa lanjutkan ke router kita.  Sebagaimana akan kita lihat, kita tidak butuh sebuah framework seperti Sinatra dalam Elixir karena kita sudah dapatkan gratis dari Plug.</p>

<p>Untuk memulai mari buat sebuah file di <code class="highlighter-rouge">lib/plug/router.ex</code> dan salin code berikut ini:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Router</span>

  <span class="n">plug</span><span class="p">(</span><span class="ss">:match</span><span class="p">)</span>
  <span class="n">plug</span><span class="p">(</span><span class="ss">:dispatch</span><span class="p">)</span>

  <span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"Welcome"</span><span class="p">))</span>
  <span class="n">match</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">"Oops!"</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ini adalah sebuah Router yang minimum tapi code nya mestinya sudah jelas.  Kita meng-include beberapa macro melalui <code class="highlighter-rouge">use Plug.Router</code> dan kemudian menset dua Plug yang built-in: <code class="highlighter-rouge">:match</code> dan <code class="highlighter-rouge">:dispatch</code>.  Ada dua route yang didefinisikan, satu untuk menangani request GET ke root dan yang kedua untuk menangani semua request lain sehingga kita bisa mengembalikan sebuah pesan 404.</p>

<p>Mari tambahkan Plug kita ke router tersebut:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Router</span>
  <span class="kn">use</span> <span class="no">Plug</span><span class="o">.</span><span class="no">ErrorHandler</span>

  <span class="n">alias</span> <span class="no">Example</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">VerifyRequest</span>

  <span class="n">plug</span><span class="p">(</span><span class="no">Plug</span><span class="o">.</span><span class="no">Parsers</span><span class="p">,</span> <span class="ss">parsers:</span> <span class="p">[</span><span class="ss">:urlencoded</span><span class="p">,</span> <span class="ss">:multipart</span><span class="p">])</span>

  <span class="n">plug</span><span class="p">(</span>
    <span class="no">VerifyRequest</span><span class="p">,</span>
    <span class="ss">fields:</span> <span class="p">[</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">"mimetype"</span><span class="p">],</span>
    <span class="ss">paths:</span> <span class="p">[</span><span class="s2">"/upload"</span><span class="p">]</span>
  <span class="p">)</span>

  <span class="n">plug</span><span class="p">(</span><span class="ss">:match</span><span class="p">)</span>
  <span class="n">plug</span><span class="p">(</span><span class="ss">:dispatch</span><span class="p">)</span>

  <span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"Welcome"</span><span class="p">))</span>
  <span class="n">post</span><span class="p">(</span><span class="s2">"/upload"</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="s2">"Uploaded"</span><span class="p">))</span>
  <span class="n">match</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">"Oops!"</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Beres! Kita sudah mensetup Plug kita untuk memverifikasi bahwa semua request ke <code class="highlighter-rouge">/upload</code> menyertakan <code class="highlighter-rouge">"content"</code> dan <code class="highlighter-rouge">"mimetype"</code>.  Hanya jika itu terpenuhi route code nya dijalankan.</p>

<p>Sementara ini endpoint <code class="highlighter-rouge">/upload</code> kita tidak begitu berguna tetapi kita sudah melihat bagaimana membuat dan mengintegrasikan Plug kita.</p>

<h2 id="menjalankan-web-app-kita">Menjalankan Web App Kita</h2>

<p>Sebelum kita bisa menjalankan aplikasi kita kita perlu mensetup dan mengkonfigurasi web server kita, yang dalam hal ini adalah Cowboy.  Untuk saat ini kita akan hanya membuat perubahan code yang perlu untuk menjalankan semuanya, dan kita akan perdalam di pelajaran-pelajaran berikutnya.</p>

<p>Mari mulai dengan mengubah bagian <code class="highlighter-rouge">application</code> dari <code class="highlighter-rouge">mix.exs</code> kita untuk memberitahu Elixir tentang apliksi kita dan menset sebuah environment variable.  Dengan perubahan itu code kita seharusnya tampak seperti berikut:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span><span class="ss">applications:</span> <span class="p">[</span><span class="ss">:cowboy</span><span class="p">,</span> <span class="ss">:plug</span><span class="p">],</span> <span class="ss">mod:</span> <span class="p">{</span><span class="no">Example</span><span class="p">,</span> <span class="p">[]},</span> <span class="ss">env:</span> <span class="p">[</span><span class="ss">cowboy_port:</span> <span class="mi">8080</span><span class="p">]]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Kemudian kita perlu mengubah <code class="highlighter-rouge">lib/example.ex</code> untuk menjalankan dan mensupervisi Cowboy:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Application</span>

  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">port</span> <span class="o">=</span> <span class="no">Application</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="ss">:example</span><span class="p">,</span> <span class="ss">:cowboy_port</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>

    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="no">Plug</span><span class="o">.</span><span class="no">Adapters</span><span class="o">.</span><span class="no">Cowboy</span><span class="o">.</span><span class="n">child_spec</span><span class="p">(</span><span class="ss">:http</span><span class="p">,</span> <span class="no">Example</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">Router</span><span class="p">,</span> <span class="p">[],</span> <span class="ss">port:</span> <span class="n">port</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Lalu untuk menjalankan aplikasi kita kita bisa gunakan:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mix run <span class="nt">--no-halt</span>
</code></pre></div></div>

<h2 id="menguji-plug">Menguji Plug</h2>

<p>Menguji Plug adalah mudah berkat <code class="highlighter-rouge">Plug.Test</code>.  <code class="highlighter-rouge">Plug.Test</code> menyertakan sejumlah fungsi yang mempermudah pengujian.</p>

<p>Coba kita lihat apakah anda bisa pahami test router ini:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">RouterTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="kn">use</span> <span class="no">Plug</span><span class="o">.</span><span class="no">Test</span>

  <span class="n">alias</span> <span class="no">Example</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">Router</span>

  <span class="nv">@content</span> <span class="s2">"&lt;html&gt;&lt;body&gt;Hi!&lt;/body&gt;&lt;/html&gt;"</span>
  <span class="nv">@mimetype</span> <span class="s2">"text/html"</span>

  <span class="nv">@opts</span> <span class="no">Router</span><span class="o">.</span><span class="n">init</span><span class="p">([])</span>

  <span class="n">test</span> <span class="s2">"returns welcome"</span> <span class="k">do</span>
    <span class="n">conn</span> <span class="o">=</span>
      <span class="n">conn</span><span class="p">(</span><span class="ss">:get</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="no">Router</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="nv">@opts</span><span class="p">)</span>

    <span class="n">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="ss">:sent</span>
    <span class="n">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"returns uploaded"</span> <span class="k">do</span>
    <span class="n">conn</span> <span class="o">=</span>
      <span class="n">conn</span><span class="p">(</span><span class="ss">:post</span><span class="p">,</span> <span class="s2">"/upload"</span><span class="p">,</span> <span class="s2">"content=</span><span class="si">#{</span><span class="nv">@content</span><span class="si">}</span><span class="s2">&amp;mimetype=</span><span class="si">#{</span><span class="nv">@mimetype</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="n">put_req_header</span><span class="p">(</span><span class="s2">"content-type"</span><span class="p">,</span> <span class="s2">"application/x-www-form-urlencoded"</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="no">Router</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="nv">@opts</span><span class="p">)</span>

    <span class="n">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="ss">:sent</span>
    <span class="n">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">201</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"returns 404"</span> <span class="k">do</span>
    <span class="n">conn</span> <span class="o">=</span>
      <span class="n">conn</span><span class="p">(</span><span class="ss">:get</span><span class="p">,</span> <span class="s2">"/missing"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="no">Router</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="nv">@opts</span><span class="p">)</span>

    <span class="n">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="ss">:sent</span>
    <span class="n">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">404</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="plug-yang-tersedia">Plug yang Tersedia</h2>

<p>Ada sejumlah Plug yang sudah disertakan.  Daftar lengkapnya dapat dilihat di dokumentasi Plug <a href="https://github.com/elixir-lang/plug#available-plugs">di sini</a>.</p>

    
    <blockquote class="edit-lesson">    
      Caught a mistake or want to contribute to the lesson?
      <a href="https://github.com/elixirschool/elixirschool/edit/master/id/lessons/specifics/plug.md" target="_blank" rel="noopener">
        Edit this page on GitHub!
      </a>
    </blockquote>
  </div>
</section>



<section>

<div class="row">
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/id/lessons/ecto/basics/" title="Basics">← Basics</a>
    </div>
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/id/lessons/specifics/eex/" title="Embedded Elixir (EEx)">Embedded Elixir (EEx) →</a>
    </div>
    
</div>
</section>




				</div>
			</div>
			<!-- Sidebar -->
  <div id="sidebar">
    <p class="toggle-theme-wrapper"><a rel="noopener" href="#toggle-theme" class="toggle-theme icon fas fa-circle-o" alt="Toggle Theme" title="Toggle Theme"></a></p>

    <div class="inner">
      
<!-- Locales Section -->
<section id="search" class="alt">
  <div id="locales">

      
        
        

        
          <a href="/en/lessons/specifics/plug/" title="Bahasa Inggris / English">en</a>
        
      
        
        

        
          <a href="/es/lessons/specifics/plug/" title="Bahasa Spanyol / Español">es</a>
        
      
        
        

        
          <a href="/gr/lessons/specifics/plug/" title="Bahasa Yunani">gr</a>
        
      
        
        

        
          <strong title="Bahasa Indonesia">id</strong>
        
      
        
        

        
          <a href="/ja/lessons/specifics/plug/" title="Bahasa Jepang / 日本語">ja</a>
        
      
        
        

        
          <a href="/ko/lessons/specifics/plug/" title="Bahasa Korea">ko</a>
        
      
        
        

        
          <a href="/pl/lessons/specifics/plug/" title="Bahasa Poland">pl</a>
        
      
        
        

        
          <a href="/pt/lessons/specifics/plug/" title="Bahasa Portugis">pt</a>
        
      
        
        

        
          <a href="/ru/lessons/specifics/plug/" title="Bahasa Rusia / Русский">ru</a>
        
      
        
        

        
          <a href="/vi/lessons/specifics/plug/" title="Bahasa Vietnam">vi</a>
        
      
        
        

        
          <a href="/zh-hans/lessons/specifics/plug/" title="Bahasa China">zh-hans</a>
        
      
        
        

        
          <a href="/zh-hant/lessons/specifics/plug/" >zh-hant</a>
        
      

  </div>
</section>


      
<!-- Menu -->
<nav id="menu">
  <span class="stack-info otp-version">Elixir 1.10.1 - Erlang/OTP 22.0 [erts-10.5.3]</span>
  <header class="major">
    <h2>Menu</h2>
    <p>Pelajaran mengenai bahasa pemrograman Elixir</p>
  </header>
  <ul>
    <li>
      <a href="/id/" class=" up ">Beranda</a>
    </li>
  
    
    
    
    
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Dasar</span>
          <ul>
        
            <li>
              
              <a href="/id/lessons/basics/basics/">1. Dasar</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/collections/">2. Koleksi</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/enum/">3. Enum</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/pattern-matching/">4. Pencocokan Pola</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/control-structures/">5. Struktur Kendali</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/functions/">6. Fungsi</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/pipe-operator/">7. Operator pipe</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/modules/">8. Composition</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/mix/">9. Mix</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/sigils/">10. Sigil</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/documentation/">11. Documentation</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/testing/">12. Testing</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/comprehensions/">13. Comprehensions</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/strings/">14. Strings</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/basics/mix-tasks/">16. Custom Mix Tasks</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Lanjutan</span>
          <ul>
        
            <li>
              
              <a href="/id/lessons/advanced/erlang/">1. Interoperabilitas dengan Erlang</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/error-handling/">2. Penanganan Error</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/escripts/">3. Executables</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/concurrency/">4. Concurrency</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/otp-concurrency/">5. OTP Concurrency</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/otp-supervisors/">6. OTP Supervisors</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/metaprogramming/">8. Metaprogramming</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/advanced/umbrella-projects/">9. Umbrella Projects</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Ecto</span>
          <ul>
        
            <li>
              
              <a href="/id/lessons/ecto/basics/">1. Basics</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener active up">Khusus</span>
          <ul>
        
            <li>
              
              <span class="active">1. Plug</span>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/specifics/eex/">2. Embedded Elixir (EEx)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/specifics/ets/">3. Erlang Term Storage (ETS)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/id/lessons/specifics/mnesia/">4. Mnesia</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    <li>
      <a href="/blog/" class=" up ">Blog</a>
    </li>
    
    <li>
      <a href="/id/report/" class=" up ">Translation Report</a>
    </li>
    
    <li>
      <a href="/contributors/" class=" up ">Contributors</a>
    </li>
  </ul>
</nav>

      <!-- Footer -->
      <footer id="footer">
        <p class="copyright">&copy; 2021 <a target="_blank" rel="noopener" href="https://github.com/doomspork">Sean Callan</a> All rights reserved.</p>
      </footer>
    </div>
  </div>

		</div>
		<!-- Scripts -->

    <script async="" src="/assets/main-f8c201d2721dcb6d1d4f6acb0ebd2b2c192757ed29271f519513e4417e347611.js" type="text/javascript"></script>
		<!--[if lte IE 8]><script async="" src="/assets/ie/respond.min-8306093ccce666c01dab405fac0d16596a1d1cf38aa0ba919d4831261662cdbb.js" type="text/javascript"></script><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	</body>
</html>
