<!DOCTYPE HTML>



<html lang="gr">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta name="description" content="Μαθήματα προγραμματισμού της γλώσσας Elixir">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="http://localhost:4000/gr/lessons/advanced/gen-stage/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="Elixir School">
  <meta property="og:locale" content="gr">
  <meta property="og:description" content="Μαθήματα προγραμματισμού της γλώσσας Elixir">
  <meta property="og:image" content="http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg">
  
  
    
    
    
    
      <link rel="alternate" hreflang="en" href="/en/lessons/advanced/gen-stage/" />
      <link rel="alternate" hreflang="x-default" href="/en/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="es" href="/es/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="el" href="/gr/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ja" href="/ja/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ko" href="/ko/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pl" href="/pl/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pt" href="/pt/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ru" href="/ru/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="vi" href="/vi/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hans" href="/zh-hans/lessons/advanced/gen-stage/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hant" href="/zh-hant/lessons/advanced/gen-stage/" />
    
  

  <link rel="canonical" href="http://localhost:4000/gr/lessons/advanced/gen-stage/">
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/assets/favicons/apple-touch-icon-06ad80501b5734bba0428ca0fc14fcbe45811a144914f7be78cdab3c3ea25458.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/assets/favicons/favicon-32x32-6e7b9eca57d29d185a5184e844c1372ce9da0a71f373f89b80ff11f120b01678.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/assets/favicons/favicon-16x16-789b56195138252cac40cf7f2425b6fcb4e71c3084abc8525781188781b958d3.png">
  <link rel="manifest" href="http://localhost:4000/manifest.json">
  <link rel="shortcut icon" href="http://localhost:4000/assets/favicons/favicon-8e1fdc2a44d6344b9871b3ecf53a803903891f82a602a3f59c65eda40f2b77b0.ico">
  <link rel="alternate" type="application/rss+xml" title="Elixir School" href="https://elixirschool.com/feed.xml" />
  <meta name="msapplication-config" content="http://localhost:4000/assets/favicons/browserconfig-e66282a6754e6899f9a53c6ebfe120749630242b741deb65f364abc297ccbc96.xml">
  <meta name="theme-color" content="#ffffff">

  
  
  <title>GenStage &middot; Elixir School</title>
  <!-- CSS -->
  <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="stylesheet" type="text/css" href="/assets/main-07a5a32c1a26652d2bb0e43b4c7ade37f20599a76cae3c1e871d3af53cff80b2.css">
  <!--[if lte IE 9]><link rel="stylesheet" type="text/css" href="/assets/ie9-0c07c3ea146a3dd5dce4effda97b3718824cab9c30149877c0e445edecfdee60.css"><![endif]-->
  <!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/assets/ie8-f0c85ce6ad95a6d33929cb969a44f41a5e96ecb22de55f55d0f3c83cfc0012fc.css"><![endif]-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>
  <script type="text/javascript">
    if ("serviceWorker" in navigator) {
      if (!navigator.serviceWorker.controller) {
        navigator.serviceWorker.register("http://localhost:4000/serviceworker.js", {
          scope: "http://localhost:4000"
        })
        .then(reg => console.log("Service worker has been registered for scope: ", reg.scope))
        .catch(error => console.log("Service worker registration has failed: ", error));
      }
    }  
  </script>
</head>

	<body class="is-loading">
    <script type="text/javascript">
    var $theme = localStorage.getItem('theme');
    if ($theme === 'dark') document.body.classList.add("dark");
    </script>
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
					  <a href="/gr/" class="logo"><strong>Elixir School</strong></a>
					  <ul class="icons">
  
  <li><iframe src="https://ghbtns.com/github-btn.html?user=elixirschool&repo=elixirschool&type=star&count=true" height="20" title="GitHub Stars" width="93" style="vertical-align: sub;"></iframe></li>
  <li><a target="_blank" rel="noopener" title="RSS" href="https://elixirschool.com/feed.xml" class="icon fa-rss-square"><span class="label">RSS</span></a></li>
  <li><a target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/gr/lessons/advanced/gen-stage/&title=GenStage&summary=description&source=http://localhost:4000" class="icon fa-linkedin"><span class="label">Linkedin</span></a></li>
  <li><a target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/intent/tweet?url=http://localhost:4000/gr/lessons/advanced/gen-stage/&via=elixirschool&text=ElixirSchool: GenStage&hashtags=learnelixir%2Celixirlang&" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
  <li><a target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/gr/lessons/advanced/gen-stage/" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
  <li><a target="_blank" rel="noopener" title="Pinterest" href="https://www.pinterest.com/pin/create/link/?url=http://localhost:4000/gr/lessons/advanced/gen-stage/&media=http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg&description=ElixirSchool: GenStage" class="icon fa-pinterest"><span class="label">Pinterest</span></a></li>
  <li><a target="_blank" rel="noopener" title="VK" href="https://vk.com/share.php?url=http://localhost:4000/gr/lessons/advanced/gen-stage/&title=ElixirSchool: GenStage&description=Check out 'GenStage' on ElixirSchool" class="icon fa-vk"><span class="label">VK</span></a></li>
  <li><a target="_blank" rel="noopener" title="Email" href="mailto:?to=&subject=ElixirSchool: GenStage&body=Check out 'GenStage' on ElixirSchool%0D%0A%0D%0Ahttp://localhost:4000/gr/lessons/advanced/gen-stage/" class="icon fa-envelope"><span class="label">Email</span></a></li>
  <li><a title="Print" href="javascript:window.print()" class="icon fa-print"><span class="label">Print</span></a></li>
</ul>

					</header>
					<section id="section-page" class="ltr">
  <header class="main">
    
    <h1 class="page-title">
  <span class="version-difference-indicator version-difference-minor"></span>
  GenStage
</h1>
<div class="version-info version-info-minor">
  <span>
    
      Ίσως υπάρχει περιεχόμενο σε αυτή τη μετάφραση που δεν είναι ενημερωμένο.<br/>
    

    Υπάρχουν αρκετές μικρές αλλαγές στο αρχικό μάθημα μετά την τελευταία ενημέρωση.
  </span>
</div>

    
  </header>
  <div class="content">
    <p>Σε αυτό το μάθημα θα δούμε πιο αναλυτικά το GenStage, τι ρόλο παίζει και πως θα το αξιοποιήσουμε στις εφαρμογές μας.</p>

<h2>Πίνακας περιεχομένων</h2>
<div id="toc"></div>

<h2 id="εισαγωγή">Εισαγωγή</h2>

<p>Τι είναι το GenStage; Από την επίσημη τεκμηρίωση, είναι “ένας προσδιορισμός και μια επεξεργαστική ροή για την Elixir”, αλλά τι σημαίνει αυτό για εμάς;</p>

<p>Σημαίνει ότι το GenStage μας παρέχει έναν τρόπο να ορίζουμε έναν αγωγό εργασίας που εκτελείται από ανεξάρτητα βήματα (ή στάδια) σε ξεχωριστές διεργασίες.  Αν έχετε δουλέψει με αγωγούς στο παρελθόν τότε μερικές από τις έννοιες θα σας είναι γνώριμες.</p>

<p>Για να κατανοήσετε καλύτερα πως δουλεύει, ας σκεφτούμε μια απλή ροή παραγωγού-καταναλωτή:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[A] -&gt; [B] -&gt; [C]
</code></pre></div></div>

<p>Σε αυτό το παράδειγμα έχουμε τρία στάδια: το <code class="highlighter-rouge">A</code> είναι ένας παραγωγός, το <code class="highlighter-rouge">B</code> είναι ένας παραγωγός-καταναλωτής και το <code class="highlighter-rouge">C</code> είναι ένας καταναλωτής.  το <code class="highlighter-rouge">A</code> παράγει μια τιμή η οποία καταναλώνεται από το <code class="highlighter-rouge">B</code>, το <code class="highlighter-rouge">B</code> κάνει κάποια εργασία και επιστρέφει μια νέα τιμή η οποία λαμβάνεται από τον καταναλωτή μας <code class="highlighter-rouge">C</code>.  Ο ρόλος του σταδίου μας είναι σημαντικός, όπως θα δούμε στον επόμενο τομέα.</p>

<p>Παρόλο που το παράδειγμά μας είναι 1-προς-1 παραγωγός-προς-καταναλωτή, είναι δυνατό να έχουμε πολλαπλούς παραγωγούς και πολλαπλούς καταναλωτές σε οποιοδήποτε στάδιο.</p>

<p>Για να παρουσιάσουμε καλύτερα αυτές τις έννοιες θα κατασκευάσουμε έναν αγωγό με το GenStage, αλλά πρώτα ας εξερευνήσουμε περισσότερο τους ρόλους στους οποίος βασίζεται το GenStage.</p>

<h2 id="καταναλωτές-και-παραγωγοί">Καταναλωτές και Παραγωγοί</h2>

<p>Όπως έχουμε διαβάσει, ο ρόλος που δίνουμε στο στάδιό μας είναι σημαντικός. Οι προδιαγραφές του GenStage αναγνωρίζουν τρεις ρόλους:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">:producer</code> — Μια πηγή.  Οι παραγωγοί περιμένουν για ζήτηση από τους καταναλωτές και ανταποκρίνονται με τα συμβάντα που ζητήθηκαν.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">:producer_consumer</code> — Ταυτόχρονα μια πηγή και ένας προορισμός.  Οι παραγωγοί-καταναλωτές μπορούν να ανταποκριθούν στη ζήτηση από άλλους καταναλωτές και να ζητήσουν συμβάντα από παραγωγούς.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">:consumer</code> — Ένας προορισμός.  Ένας καταναλωτής ζητάει και λαμβάνει δεδομένα από παραγωγούς.</p>
  </li>
</ul>

<p>Παρατηρείτε ότι οι παραγωγοί μας <strong>περιμένουν</strong> για ζήτηση; Με το GenStage οι καταναλωτές στέλνουν αιτήσεις προς τα πάνω και επεξεργάζονται τα δεδομένα από τον παραγωγό.  Αυτό διευκολύνει ένα μηχανισμό γνωστό ως αντίθλιψη.  Η αντίθλιψη βάζει το βάρος στον παραγωγό ώστε να μην πιέζει υπερβολικά όταν οι καταναλωτές είναι απασχολημένοι.</p>

<p>Τώρα που καλύψαμε τους ρόλους στο GenStage, ας ξεκινήσουμε με την εφαρμογή μας.</p>

<h2 id="ξεκινώντας">Ξεκινώντας</h2>

<p>Σε αυτό το παράδειγμα θα κατασκευάσουμε μια εφαρμογή GenStage που στέλνει αριθμούς, ταξινομεί τους ζυγούς και τέλος τους τυπώνει.</p>

<p>Για την εφαρμογή μας θα χρησιμοποιήσουμε και τους τρεις ρόλους GenStage. Ο παραγωγός μας θα είναι υπεύθυνος για το μέτρημα και την αποστολή των αριθμών.  Θα χρησιμοποιήσουμε ένα παραγωγό-καταναλωτή για να φιλτράρουμε τους ζυγούς αριθμούς και αργότερα να ανταποκρινόμαστε στη ζήτηση από κάτω.  Τέλος θα χτίσουμε ένα καταναλωτή για να εμφανίσουμε τους εναπομείναντες αριθμούς.</p>

<p>Θα ξεκινήσουμε δημιουργώντας ένα project με ένα δέντρο παρακολούθησης:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mix new genstage_example <span class="nt">--sup</span>
<span class="nv">$ </span><span class="nb">cd </span>genstage_example
</code></pre></div></div>

<p>Ας αναβαθμίσουμε τις εξαρτήσεις μας στο <code class="highlighter-rouge">mix.exs</code> για να συμπεριλάβουμε το <code class="highlighter-rouge">gen_stage</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="p">{</span><span class="ss">:gen_stage</span><span class="p">,</span> <span class="s2">"~&gt; 0.11"</span><span class="p">},</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Θα πρέπει να κατεβάσουμε τις εξαρτήσεις μας και να τις συντάξουμε πριν προχωρήσουμε:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mix <span class="k">do </span>deps.get, compile
</code></pre></div></div>

<p>Τώρα είμαστε έτοιμοι να χτίστουμε τον παραγωγό μας!</p>

<h2 id="παραγωγός">Παραγωγός</h2>

<p>Το πρώτο βήμα της εφαρμογής GenStage μας είναι να δημιουργήσουμε τον παραγωγό μας. Όπως συζητήσαμε πριν, θέλουμε να δημιουργήσουμε ένα παραγωγό που στέλνει μια συνεχή ροή αριθμών.  Ας δημιουργήσουμε το αρχείο παραγωγού:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>lib/genstage_example
<span class="nv">$ </span><span class="nb">touch </span>lib/genstage_example/producer.ex
</code></pre></div></div>

<p>Τώρα μπορούμε να προσθέσουμε τον κώδικα:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">GenstageExample</span><span class="o">.</span><span class="no">Producer</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenStage</span>

  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">initial</span> <span class="p">\\</span> <span class="mi">0</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">GenStage</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="ss">name:</span> <span class="bp">__MODULE__</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">counter</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="ss">:producer</span><span class="p">,</span> <span class="n">counter</span><span class="p">}</span>

  <span class="k">def</span> <span class="n">handle_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">events</span> <span class="o">=</span> <span class="no">Enum</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">state</span><span class="o">..</span><span class="p">(</span><span class="n">state</span> <span class="o">+</span> <span class="n">demand</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">state</span> <span class="o">+</span> <span class="n">demand</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Τα δύο πιο σημαντικά μέρη που πρέπει να σημειώσουμε εδώ είναι οι <code class="highlighter-rouge">init/1</code> και <code class="highlighter-rouge">handle_demand/2</code>.  Στην <code class="highlighter-rouge">init/1</code> ορίζουμε την αρχική κατάσταση όπως θα κάναμε στους GenServers μας αλλά το πιο σημαντικό είναι ότι μας βάζουμε την ταμπέλα του παραγωγού.  Η απάντηση της συνάρτησής μας <code class="highlighter-rouge">init/1</code> είναι αυτή στην οποία στηρίζεται το GenStage για να ταξινομήσει την διεργασία μας.</p>

<p>Η συνάρτηση <code class="highlighter-rouge">handle_demand/2</code> είναι εκεί που ορίζεται το μεγαλύτερο μέρος του παραγωγού μας.  Πρέπει να υλοποιηθεί από όλους τους GenStage παραγωγούς.  Εδώ επιστρέφουμε το σετ των αριθμών που ζητούνται από τους καταναλωτές μας και αυξάνουμε το μετρητή μας.  Η ζήτηση από τους καταναλωτές, η μεταβλητή <code class="highlighter-rouge">demand</code> στον κώδικα από πάνω, είναι ένας ακέραιος που αναπαριστά τον αριθμό των συμβάντων που μπορούν να χειριστούν, με προκαθορισμένο το 1000.</p>

<h2 id="παραγωγός-καταναλωτής">Παραγωγός Καταναλωτής</h2>

<p>Τώρα που έχουμε έναν παραγωγό-γεννήτρια αριθμών ας μεταβούμε στον παραγωγό-καταναλωτή μας.  Θα θέλουμε να ζητήσουμε αριθμούς από τον παραγωγό μας, να αφαιρέσουμε τους μονούς και να απαντήσουμε στη ζήτηση.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">touch </span>lib/genstage_example/producer_consumer.ex
</code></pre></div></div>

<p>Ας αναβαθμίσουμε το αρχείο μας για να δείχνει όπως ο κώδικας στο παράδειγμα:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">GenstageExample</span><span class="o">.</span><span class="no">ProducerConsumer</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenStage</span>

  <span class="kn">require</span> <span class="no">Integer</span>

  <span class="k">def</span> <span class="n">start_link</span> <span class="k">do</span>
    <span class="no">GenStage</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:state_doesnt_matter</span><span class="p">,</span> <span class="ss">name:</span> <span class="bp">__MODULE__</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:producer_consumer</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="ss">subscribe_to:</span> <span class="p">[</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">Producer</span><span class="p">]}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_events</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">_from</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">numbers</span> <span class="o">=</span>
      <span class="n">events</span>
      <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">&amp;</span><span class="no">Integer</span><span class="o">.</span><span class="n">is_even</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Όπως ίσως παρατηρήσατε, με τον παραγωγό-καταναλωτή μας παρουσιάζουμε μια νέα συνάρτηση, την <code class="highlighter-rouge">handle_events/3</code> και μια νέα επιλογή στην <code class="highlighter-rouge">init/1</code>.  Με την επιλογή <code class="highlighter-rouge">subscribe_to</code> καθοδηγούμε το GenStage να μας βάλει σε επικοινωνία με ένα συγκεκριμμένο παραγωγό.</p>

<p>Η μέθοδος <code class="highlighter-rouge">handle_events/3</code> είναι η κινητήριος δύναμή μας, εκεί όπου λαμβάνουμε τα εισερχόμενα συμβάντα, τα επεξεργαζόμαστε και επιστρέφουμε το μεταμορφωμένο σετ.  Όπως θα δούμε οι καταναλωτές υλοποιούνται με περίπου τον ίδιο τρόπο αλλά η σημαντική διαφορά είναι στο τι επιστρέφει η μέθοδος <code class="highlighter-rouge">handle_events/3</code> και στο πως χρησιμοποιείται. Όταν μαρκάρουμε την διεργασία μας σαν παραγωγό-καταναλωτή το δεύτερο όρισμα της τούπλας μας, η <code class="highlighter-rouge">numbers</code> σε αυτή την περίπτωση, χρησιμοποιείται για να ανταποκριθεί στη ζήτηση προς τα κάτω.  Στους καταναλωτές αυτή η τιμή απορρίπτεται.</p>

<h2 id="καταναλωτής">Καταναλωτής</h2>

<p>Τελευταίο αλλά εξίσου σημαντικό έχουμε τον καταναλωτή μας.  Ας ξεκινήσουμε:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">touch </span>lib/genstage_example/consumer.ex
</code></pre></div></div>

<p>Από τη στιγμή που οι καταναλωτές και οι παραγωγοί-καταναλωτές είναι τόσο όμοιοι ο κώδικάς μας δεν θα δείχνει τόσο διαφορετικός:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">GenstageExample</span><span class="o">.</span><span class="no">Consumer</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenStage</span>

  <span class="k">def</span> <span class="n">start_link</span> <span class="k">do</span>
    <span class="no">GenStage</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:state_doesnt_matter</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:consumer</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="ss">subscribe_to:</span> <span class="p">[</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">ProducerConsumer</span><span class="p">]}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_events</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">_from</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">for</span> <span class="n">event</span> <span class="o">&lt;-</span> <span class="n">events</span> <span class="k">do</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p">({</span><span class="n">self</span><span class="p">(),</span> <span class="n">event</span><span class="p">,</span> <span class="n">state</span><span class="p">})</span>
    <span class="k">end</span>

    <span class="c1"># As a consumer we never emit events</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">[],</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Όπως είδαμε στον προηγούμενο τομέα ο καταναλωτής μας δεν στέλνει συμβάντα, έτσι η δεύτερη τιμή στην τούπλα μας θα απορριφθεί.</p>

<h2 id="συνδεση">Συνδεση</h2>

<p>Τώρα που έχουμε τον παραγωγό μας, τον παραγωγό-καταναλωτή και τον καταναλωτή έτοιμους είμαστε έτοιμοι να τους συνδέσουμε.</p>

<p>Ας ξεκινήσουμε ανοίγοντας το <code class="highlighter-rouge">lib/genstage_example/application.ex</code> και προσθέτοντας τις διεργασίες μας στο δέντρο παρακολούθησης:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="no">Supervisor</span><span class="o">.</span><span class="no">Spec</span><span class="p">,</span> <span class="ss">warn:</span> <span class="no">false</span>

  <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">Producer</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">ProducerConsumer</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">Consumer</span><span class="p">,</span> <span class="p">[])</span>
  <span class="p">]</span>

  <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">GenstageExample</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">]</span>
  <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Αν όλα είναι σωστά, μπορούμε να τρέξουμε το project και θα πρέπει να δούμε τα πάντα να δουλέυουν:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mix run <span class="nt">--no-halt</span>
<span class="o">{</span><span class="c">#PID&lt;0.109.0&gt;, 2, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.109.0&gt;, 4, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.109.0&gt;, 6, :state_doesnt_matter}</span>
...
<span class="o">{</span><span class="c">#PID&lt;0.109.0&gt;, 229062, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.109.0&gt;, 229064, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.109.0&gt;, 229066, :state_doesnt_matter}</span>
</code></pre></div></div>

<p>Τα καταφέραμε!  Όπως αναμέναμε η εφαρμογή μας στέλνει μόνο ζυγούς αριθμούς και το κάνει <strong>γρήγορα</strong>.</p>

<p>Σε αυτό το σημείο έχουμε έναν αγωγό που λειτουργεί.  Υπαρχει ένας παραγωγός που στέλνει αριθμούς, ένας παραγωγός καταναλωτής που διαγράφει τους μονούς αριθμούς, και ένας καταναλωτής που τα εμφανίζει όλα αυτά και συνεχίζει τη ροή.</p>

<h2 id="πολλαπλοί-παραγωγοί-ή-καταναλωτές">Πολλαπλοί Παραγωγοί ή Καταναλωτές</h2>

<p>Αναφέραμε στην εισαγωγή ότι θα μπορούσαμε να έχουμε πάνω από ένα παραγωγούς ή καταναλωτές, οπότε ας ρίξουμε μια ματιά σε αυτά.</p>

<p>Αν εξετάσουμε την έξοδο της <code class="highlighter-rouge">IO.inspect/1</code> από το παράδειγμά μας θα δούμε ότι κάθε συμβάν το χειρίζεται μια μοναδική PID.  Ας κάνουμε κάποιες αλλαγές για πολλαπλούς εργάτες αλλάζοντας το <code class="highlighter-rouge">lib/genstage_example/application.ex</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">Producer</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
  <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">ProducerConsumer</span><span class="p">,</span> <span class="p">[]),</span>
  <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">Consumer</span><span class="p">,</span> <span class="p">[],</span> <span class="ss">id:</span> <span class="mi">1</span><span class="p">),</span>
  <span class="n">worker</span><span class="p">(</span><span class="no">GenstageExample</span><span class="o">.</span><span class="no">Consumer</span><span class="p">,</span> <span class="p">[],</span> <span class="ss">id:</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Τώρα που ορίσαμε δύο καταναλωτές ας δούμε τι παίρνουμε αν τρέξουμε τώρα την εφαρμογή μας:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mix run <span class="nt">--no-halt</span>
<span class="o">{</span><span class="c">#PID&lt;0.120.0&gt;, 2, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.121.0&gt;, 4, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.120.0&gt;, 6, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.120.0&gt;, 8, :state_doesnt_matter}</span>
...
<span class="o">{</span><span class="c">#PID&lt;0.120.0&gt;, 86478, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.121.0&gt;, 87338, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.120.0&gt;, 86480, :state_doesnt_matter}</span>
<span class="o">{</span><span class="c">#PID&lt;0.120.0&gt;, 86482, :state_doesnt_matter}</span>
</code></pre></div></div>

<p>Όπως θα δείτε τώρα έχουμε πολλαπλά PID, απλά προσθέτοντας μια γραμμή κώδικα και δίνοντας ID στους καταναλωτές μας.</p>

<h2 id="περιπτώσεις-χρήσης">Περιπτώσεις Χρήσης</h2>

<p>Τώρα που καλύψαμε το GenStage και χτίσαμε την πρώτη μας δοκιμαστική εφαρμογή, ποιές είναι μερικές από τις <em>πραγματικές</em> περιπτώσεις χρήσης για το GenStage;</p>

<ul>
  <li>
    <p>Αγωγός Μετατροπής Δεδομένων — Οι παραγωγοί δεν χρειάζεται να είναι απλές γεννήτριες αριθμών. θα μπορούσαμε να παράγουμε συμβάντα από μια βάση δεδομένων ή ακόμα από μια άλλη πηγή όπως η Apache Kafka.  Με ένα συνδυασμό παραγωγών-καταναλωτών και καταναλωτών θα μπορούσαμε να παράγουμε, ταξινομήσουμε, καταγράψουμε και αποθηκεύσουμε μετρήσεις καθώς γίνονται διαθέσιμες.</p>
  </li>
  <li>
    <p>Ουρά Εργασίας — Αφού τα συμβάντα μπορούν να είναι οτιδήποτε θα μπορούσαμε να παράγουμε εργασίες μονάδων για να ολοκληρωθούν από μια σειρά καταναλωτών.</p>
  </li>
  <li>
    <p>Επεξεργασία Συμβάντων — Παρόμοια στον αγωγό δεδομένων θα μπορούσαμε να λαμβάνουμε, επεξεργαζόμαστε, ταξινομούμε και να δρούμε πάνω σε συμβάντα που στέλνονται σε πραγματικό χρόνο από τις πηγές μας.</p>
  </li>
</ul>

<p>Αυτές είναι μόλις <strong>μερικές</strong> από τις δυνατότητες για το GenStage.</p>

    
    <blockquote class="edit-lesson">    
      Caught a mistake or want to contribute to the lesson?
      <a href="https://github.com/elixirschool/elixirschool/edit/master/gr/lessons/advanced/gen-stage.md" target="_blank" rel="noopener">
        Edit this page on GitHub!
      </a>
    </blockquote>
  </div>
</section>



<section>

<div class="row">
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/gr/lessons/advanced/behaviours/" title="Συμπεριφορές">← Συμπεριφορές</a>
    </div>
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/gr/lessons/advanced/protocols/" title="Πρωτόκολλα">Πρωτόκολλα →</a>
    </div>
    
</div>
</section>




				</div>
			</div>
			<!-- Sidebar -->
  <div id="sidebar">
    <p class="toggle-theme-wrapper"><a rel="noopener" href="#toggle-theme" class="toggle-theme icon fas fa-circle-o" alt="Toggle Theme" title="Toggle Theme"></a></p>

    <div class="inner">
      
<!-- Locales Section -->
<section id="search" class="alt">
  <div id="locales">

      
        
        

        
          <a href="/en/lessons/advanced/gen-stage/" title="English">en</a>
        
      
        
        

        
          <a href="/es/lessons/advanced/gen-stage/" title="Español">es</a>
        
      
        
        

        
          <strong >gr</strong>
        
      
        
        

        
          <a href="/ja/lessons/advanced/gen-stage/" title="日本語">ja</a>
        
      
        
        

        
          <a href="/ko/lessons/advanced/gen-stage/" >ko</a>
        
      
        
        

        
          <a href="/pl/lessons/advanced/gen-stage/" >pl</a>
        
      
        
        

        
          <a href="/pt/lessons/advanced/gen-stage/" >pt</a>
        
      
        
        

        
          <a href="/ru/lessons/advanced/gen-stage/" title="Русский">ru</a>
        
      
        
        

        
          <a href="/vi/lessons/advanced/gen-stage/" >vi</a>
        
      
        
        

        
          <a href="/zh-hans/lessons/advanced/gen-stage/" >zh-hans</a>
        
      
        
        

        
          <a href="/zh-hant/lessons/advanced/gen-stage/" >zh-hant</a>
        
      

  </div>
</section>


      
<!-- Menu -->
<nav id="menu">
  <span class="stack-info otp-version">Elixir 1.10.1 - Erlang/OTP 22.0 [erts-10.5.3]</span>
  <header class="major">
    <h2>Menu</h2>
    <p>Μαθήματα προγραμματισμού της γλώσσας Elixir</p>
  </header>
  <ul>
    <li>
      <a href="/gr/" class="">Home</a>
    </li>
  
    
    
    
    
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener">Βασικά</span>
          <ul>
        
            <li>
              
              <a href="/gr/lessons/basics/basics/">1. Βασικά</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/collections/">2. Συλλογές</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/enum/">3. Enum</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/pattern-matching/">4. Αντιπαραβολές Προτύπων</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/control-structures/">5. Δομές Ελέγχου</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/functions/">6. Συναρτήσεις</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/pipe-operator/">7. Τελεστής Σωλήνα</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/modules/">8. Ενότητες</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/mix/">9. Mix</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/sigils/">10. Σφραγίδες</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/documentation/">11. Τεκμηρίωση</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/testing/">12. Δοκιμές</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/comprehensions/">13. Ανάγνωση Λιστών</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/strings/">14. Αλφαριθμητικά</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/date-time/">15. Ημερομηνία και Ώρα</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/mix-tasks/">16. Ειδικές Εργασίες Mix</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/basics/iex-helpers/">17. Βοηθοί IEx</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener active">Προχωρημένα</span>
          <ul>
        
            <li>
              
              <a href="/gr/lessons/advanced/erlang/">1. Διαλειτουργικότητα με την Erlang</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/error-handling/">2. Διαχείριση Σφαλμάτων</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/escripts/">3. Εκτελέσιμα</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/concurrency/">4. Συγχρονισμός</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/otp-concurrency/">5. Συγχρονισμός OTP</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/otp-supervisors/">6. Επιτηρητές OTP</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/metaprogramming/">8. Μεταπρογραμματισμός</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/umbrella-projects/">9. Projects Ομπρέλας</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/typespec/">10. Προδιαγραφές και τύποι</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/behaviours/">11. Συμπεριφορές</a>
              
            </li>
        
      
        
            <li>
              
              <span class="active">12. GenStage</span>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/advanced/protocols/">13. Πρωτόκολλα</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener">Ecto</span>
          <ul>
        
            <li>
              
              <a href="/gr/lessons/ecto/basics/">1. Basics</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/ecto/changesets/">2. Σετ Αλλαγών</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/ecto/associations/">3. Συσχετισμοί</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener">Ιδιαιτερότητες</span>
          <ul>
        
            <li>
              
              <a href="/gr/lessons/specifics/plug/">1. Plug</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/specifics/eex/">2. Ένθετη Elixir (EEx)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/specifics/ets/">3. Erlang Term Storage (ETS)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/specifics/mnesia/">4. Mnesia</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/specifics/debugging/">5. Debugging</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener">Βιβλιοθήκες</span>
          <ul>
        
            <li>
              
              <a href="/gr/lessons/libraries/guardian/">1. Guardian (Βασικά)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/libraries/poolboy/">2. Poolboy</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/gr/lessons/libraries/benchee/">3. Benchee</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    <li>
      <a href="/blog/" class="">Blog</a>
    </li>
    
    <li>
      <a href="/gr/report/" class="">Αναφορά Μετάφρασης</a>
    </li>
    
    <li>
      <a href="/contributors/" class="">Contributors</a>
    </li>
  </ul>
</nav>

      <!-- Footer -->
      <footer id="footer">
        <p class="copyright">&copy; 2021 <a target="_blank" rel="noopener" href="https://github.com/doomspork">Sean Callan</a> All rights reserved.</p>
      </footer>
    </div>
  </div>

		</div>
		<!-- Scripts -->

    <script async="" src="/assets/main-f8c201d2721dcb6d1d4f6acb0ebd2b2c192757ed29271f519513e4417e347611.js" type="text/javascript"></script>
		<!--[if lte IE 8]><script async="" src="/assets/ie/respond.min-8306093ccce666c01dab405fac0d16596a1d1cf38aa0ba919d4831261662cdbb.js" type="text/javascript"></script><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	</body>
</html>
