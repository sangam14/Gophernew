<!DOCTYPE HTML>



<html lang="zh-hans">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta name="description" content="Elixir 编程语言教程">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="http://localhost:4000/zh-hans/lessons/specifics/mnesia/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="Elixir School">
  <meta property="og:locale" content="zh-hans">
  <meta property="og:description" content="Elixir 编程语言教程">
  <meta property="og:image" content="http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg">
  
  
    
    
    
    
      <link rel="alternate" hreflang="en" href="/en/lessons/specifics/mnesia/" />
      <link rel="alternate" hreflang="x-default" href="/en/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="es" href="/es/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="el" href="/gr/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="id" href="/id/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ko" href="/ko/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pl" href="/pl/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pt" href="/pt/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ru" href="/ru/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="th" href="/th/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="vi" href="/vi/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hans" href="/zh-hans/lessons/specifics/mnesia/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hant" href="/zh-hant/lessons/specifics/mnesia/" />
    
  

  <link rel="canonical" href="http://localhost:4000/zh-hans/lessons/specifics/mnesia/">
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/assets/favicons/apple-touch-icon-06ad80501b5734bba0428ca0fc14fcbe45811a144914f7be78cdab3c3ea25458.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/assets/favicons/favicon-32x32-6e7b9eca57d29d185a5184e844c1372ce9da0a71f373f89b80ff11f120b01678.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/assets/favicons/favicon-16x16-789b56195138252cac40cf7f2425b6fcb4e71c3084abc8525781188781b958d3.png">
  <link rel="manifest" href="http://localhost:4000/manifest.json">
  <link rel="shortcut icon" href="http://localhost:4000/assets/favicons/favicon-8e1fdc2a44d6344b9871b3ecf53a803903891f82a602a3f59c65eda40f2b77b0.ico">
  <link rel="alternate" type="application/rss+xml" title="Elixir School" href="https://elixirschool.com/feed.xml" />
  <meta name="msapplication-config" content="http://localhost:4000/assets/favicons/browserconfig-e66282a6754e6899f9a53c6ebfe120749630242b741deb65f364abc297ccbc96.xml">
  <meta name="theme-color" content="#ffffff">

  
  
  <title>Mnesia 数据库 &middot; Elixir School</title>
  <!-- CSS -->
  <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="stylesheet" type="text/css" href="/assets/main-07a5a32c1a26652d2bb0e43b4c7ade37f20599a76cae3c1e871d3af53cff80b2.css">
  <!--[if lte IE 9]><link rel="stylesheet" type="text/css" href="/assets/ie9-0c07c3ea146a3dd5dce4effda97b3718824cab9c30149877c0e445edecfdee60.css"><![endif]-->
  <!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/assets/ie8-f0c85ce6ad95a6d33929cb969a44f41a5e96ecb22de55f55d0f3c83cfc0012fc.css"><![endif]-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>
  <script type="text/javascript">
    if ("serviceWorker" in navigator) {
      if (!navigator.serviceWorker.controller) {
        navigator.serviceWorker.register("http://localhost:4000/serviceworker.js", {
          scope: "http://localhost:4000"
        })
        .then(reg => console.log("Service worker has been registered for scope: ", reg.scope))
        .catch(error => console.log("Service worker registration has failed: ", error));
      }
    }  
  </script>
</head>

	<body class="is-loading">
    <script type="text/javascript">
    var $theme = localStorage.getItem('theme');
    if ($theme === 'dark') document.body.classList.add("dark");
    </script>
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
					  <a href="/zh-hans/" class="logo"><strong>Elixir School</strong></a>
					  <ul class="icons">
  
  <li><iframe src="https://ghbtns.com/github-btn.html?user=elixirschool&repo=elixirschool&type=star&count=true" height="20" title="GitHub Stars" width="93" style="vertical-align: sub;"></iframe></li>
  <li><a target="_blank" rel="noopener" title="RSS" href="https://elixirschool.com/feed.xml" class="icon fa-rss-square"><span class="label">RSS</span></a></li>
  <li><a target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/zh-hans/lessons/specifics/mnesia/&title=Mnesia 数据库&summary=description&source=http://localhost:4000" class="icon fa-linkedin"><span class="label">Linkedin</span></a></li>
  <li><a target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/intent/tweet?url=http://localhost:4000/zh-hans/lessons/specifics/mnesia/&via=elixirschool&text=ElixirSchool: Mnesia 数据库&hashtags=learnelixir%2Celixirlang&" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
  <li><a target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/zh-hans/lessons/specifics/mnesia/" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
  <li><a target="_blank" rel="noopener" title="Pinterest" href="https://www.pinterest.com/pin/create/link/?url=http://localhost:4000/zh-hans/lessons/specifics/mnesia/&media=http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg&description=ElixirSchool: Mnesia 数据库" class="icon fa-pinterest"><span class="label">Pinterest</span></a></li>
  <li><a target="_blank" rel="noopener" title="VK" href="https://vk.com/share.php?url=http://localhost:4000/zh-hans/lessons/specifics/mnesia/&title=ElixirSchool: Mnesia 数据库&description=Check out 'Mnesia 数据库' on ElixirSchool" class="icon fa-vk"><span class="label">VK</span></a></li>
  <li><a target="_blank" rel="noopener" title="Email" href="mailto:?to=&subject=ElixirSchool: Mnesia 数据库&body=Check out 'Mnesia 数据库' on ElixirSchool%0D%0A%0D%0Ahttp://localhost:4000/zh-hans/lessons/specifics/mnesia/" class="icon fa-envelope"><span class="label">Email</span></a></li>
  <li><a title="Print" href="javascript:window.print()" class="icon fa-print"><span class="label">Print</span></a></li>
</ul>

					</header>
					<section id="section-page" class="ltr">
  <header class="main">
    
    <h1 class="page-title">
  <span class="version-difference-indicator version-difference-none"></span>
  Mnesia 数据库
</h1>
<div class="version-info version-info-none">
  <span>
    

    This translation is up to date.
  </span>
</div>

    
  </header>
  <div class="content">
    <p>Mnesia 是一个强大的分布式实时数据库管理系统。</p>

<h2>目录</h2>
<div id="toc"></div>

<h2 id="概要">概要</h2>

<p>Mnesia 是 Erlang 运行时中自带的一个数据库管理系统（DBMS），也可以在 Elixir 中很自然地使用。Mnesia 的数据库模型可以混合了关系型和对象型数据模型的特征，让它可以用来开发任何规模的分布式应用程序。</p>

<h2 id="应用场景">应用场景</h2>

<p>何时该使用何种技术常常是一个令人困惑的事情。如果下面这些问题中任意一个的答案是 yes 的话，则是一个很好的迹象告诉我们在这个情况下用 Mnesia 比用 ETS 或者 DETS 要适合。</p>

<ul>
  <li>我是否需要回滚事务？</li>
  <li>我是否需要用一个简单的语法来读写数据？</li>
  <li>我是否需要在多于一个以上的节点存储数据？</li>
  <li>我是否需要选择数据存储的位置（内存还是硬盘）？</li>
</ul>

<h2 id="schema">Schema</h2>

<p>因为 Mnesia 属于 Erlang 核心的一部分，但是 Elixir 还没有包含它 ，所以我们要用 <code class="highlighter-rouge">:mnesia</code> 这种方式去引用 Mnesia （参考<a href="../../advanced/erlang/">和 Erlang 互操作</a>）。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:mnesia</span><span class="o">.</span><span class="n">create_schema</span><span class="p">([</span><span class="n">node</span><span class="p">()])</span>

<span class="c1"># or if you prefer the Elixir feel...</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="n">alias</span> <span class="ss">:mnesia</span><span class="p">,</span> <span class="ss">as:</span> <span class="no">Mnesia</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">create_schema</span><span class="p">([</span><span class="n">node</span><span class="p">()])</span>
</code></pre></div></div>

<p>在本课中，我们会使用后一种方式来使用 Mnesia 的 API。<code class="highlighter-rouge">Mnesia.create_schema/1</code> 会初始化一个空的 Schema 并且传递给一个节点列表。 在本例中，我们传入的是当前 IEx 会话所在的节点。</p>

<h2 id="节点node">节点（Node）</h2>

<p>一旦我们在 IEx 中执行了 <code class="highlighter-rouge">Mnesia.create_schema([node()])</code> 命令后，我们就可以在当前目录下看到一个叫 <strong>Mnesia.nonode@nohost</strong> 或者类似名字的文件夹。你也许会好奇到底 <strong>nonode@nohost</strong> 代表着什么，因为在之前的课程中它没有出现过。所以我们接下来就来一探究竟：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>iex <span class="nt">--help</span>
Usage: iex <span class="o">[</span>options] <span class="o">[</span>.exs file] <span class="o">[</span>data]

  <span class="nt">-v</span>                Prints version
  <span class="nt">-e</span> <span class="s2">"command"</span>      Evaluates the given <span class="nb">command</span> <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">-r</span> <span class="s2">"file"</span>         Requires the given files/patterns <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">-S</span> <span class="s2">"script"</span>       Finds and executes the given script
  <span class="nt">-pr</span> <span class="s2">"file"</span>        Requires the given files/patterns <span class="k">in </span>parallel <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">-pa</span> <span class="s2">"path"</span>        Prepends the given path to Erlang code path <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">-pz</span> <span class="s2">"path"</span>        Appends the given path to Erlang code path <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">--app</span> <span class="s2">"app"</span>       Start the given app and its dependencies <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">--erl</span> <span class="s2">"switches"</span>  Switches to be passed down to Erlang <span class="o">(</span><span class="k">*</span><span class="o">)</span>
  <span class="nt">--name</span> <span class="s2">"name"</span>     Makes and assigns a name to the distributed node
  <span class="nt">--sname</span> <span class="s2">"name"</span>    Makes and assigns a short name to the distributed node
  <span class="nt">--cookie</span> <span class="s2">"cookie"</span> Sets a cookie <span class="k">for </span>this distributed node
  <span class="nt">--hidden</span>          Makes a hidden node
  <span class="nt">--werl</span>            Uses Erlang<span class="s1">'s Windows shell GUI (Windows only)
  --detached        Starts the Erlang VM detached from console
  --remsh "name"    Connects to a node using a remote shell
  --dot-iex "path"  Overrides default .iex.exs file and uses path instead;
                    path can be empty, then no file will be loaded

** Options marked with (*) can be given more than once
** Options given after the .exs file or -- are passed down to the executed code
** Options can be passed to the VM using ELIXIR_ERL_OPTIONS or --erl
</span></code></pre></div></div>

<p>当你给 IEx 传递 <code class="highlighter-rouge">--help</code> 选项的时候，IEx 会列出所有可用的选项。我们可以看到有 <code class="highlighter-rouge">--name</code> 和 <code class="highlighter-rouge">--sname</code> 两个选项可以给节点起名。
一个节点（Node）就是一个运行中的 Erlang 虚拟机，它独自管理着自己的通信，垃圾回收，进程调度以及内存等等。这个节点默认情况下被简单的称为 <strong>nonode@nohost</strong> 。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>iex <span class="nt">--name</span> learner@elixirschool.com

Erlang/OTP 22.0 <span class="o">[</span>erts-10.5.3] <span class="o">[</span><span class="nb">source</span><span class="o">]</span> <span class="o">[</span>64-bit] <span class="o">[</span>smp:4:4] <span class="o">[</span>async-threads:10] <span class="o">[</span>hipe] <span class="o">[</span>kernel-poll:false] <span class="o">[</span>dtrace]

Interactive Elixir <span class="o">(</span>1.10.1<span class="o">)</span> - press Ctrl+C to <span class="nb">exit</span> <span class="o">(</span><span class="nb">type </span>h<span class="o">()</span> ENTER <span class="k">for </span><span class="nb">help</span><span class="o">)</span>
iex<span class="o">(</span>learner@elixirschool.com<span class="o">)&gt;</span> Node.self
:<span class="s2">"learner@elixirschool.com"</span>
</code></pre></div></div>

<p>我们可以看到，当我给节点起名后，我们当前的节点名字已经叫做 <code class="highlighter-rouge">:"learner@elixirschool.com"</code>。如果我们再运行 <code class="highlighter-rouge">Mnesia.create_schema([node()])</code> 的话，我们会看到另外一个叫做 <strong>Mnesia.learner@elixirschool.com</strong> 的文件夹。这样设计的目的很简单。Erlang 中的节点只是用来连接其他节点用以分享（分发）信息和资源，它们并不一定要在同一台机器上，也可以通过局域网或者互联网等方式通信。</p>

<h2 id="启动-mnesia">启动 Mnesia</h2>

<p>我们已经了解了如何设置 Mnesia 数据库，现在我们就可以通过 <code class="highlighter-rouge">Mnesia.start/0</code> 来启动它了。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">alias</span> <span class="ss">:mnesia</span><span class="p">,</span> <span class="ss">as:</span> <span class="no">Mnesia</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">create_schema</span><span class="p">([</span><span class="n">node</span><span class="p">()])</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>函数 <code class="highlighter-rouge">Mnesia.start/0</code> 是异步的。 它会初始化现有的表并返回原子 <code class="highlighter-rouge">:ok</code> 如果我们需要在启动 Mnesia 之后立即对现有表执行某些操作，我们需要调用<code class="highlighter-rouge">Mnesia.wait_for_tables/2</code> 函数。 它会挂起调用者，直到表被初始化。 具体请参阅<a href="#数据初始化和迁移">数据初始化和迁移一节中的示例</a></p>

<p>需要注意的是，如果是在一个有多个节点的分布式系统中运行 Mnesia，必须要在每一个参与的节点上面运行 <code class="highlighter-rouge">Mnesia.start/1</code>。</p>

<h2 id="创建表">创建表</h2>

<p>我们可以用 <code class="highlighter-rouge">Mnesia.create_table/2</code> 在数据库中创建表。下面的例子中，我们创建了一个名为 <code class="highlighter-rouge">Person</code> 的表，并且通过一个关键字列表来定义结构。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="p">[</span><span class="ss">attributes:</span> <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:job</span><span class="p">]])</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">}</span>
</code></pre></div></div>

<p>我们使用原子 <code class="highlighter-rouge">:id</code>, <code class="highlighter-rouge">:name</code> 和 <code class="highlighter-rouge">:job</code> 定义了表的字段。第一个原子作为主键(也就是 <code class="highlighter-rouge">:id</code>)，并且至少需要一个附加属性。
当我们执行 <code class="highlighter-rouge">Mnesia.create_table/2</code> 可能返回下面两种结果中的任意一种：</p>

<ul>
  <li><code class="highlighter-rouge">{:atomic, :ok}</code> 代表执行成功</li>
  <li><code class="highlighter-rouge">{:aborted, Reason}</code> 代表执行失败</li>
</ul>

<p>如果数据库中已经存在同名的表，返回结果中的 <code class="highlighter-rouge">Reason</code> 为 <code class="highlighter-rouge">{:already_exists, table}</code>。所以当我们再执行一次上面的命令是，我们会得到下面的结果：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="p">[</span><span class="ss">attributes:</span> <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:job</span><span class="p">]])</span>
<span class="p">{</span><span class="ss">:aborted</span><span class="p">,</span> <span class="p">{</span><span class="ss">:already_exists</span><span class="p">,</span> <span class="no">Person</span><span class="p">}}</span>
</code></pre></div></div>

<h2 id="脏操作">脏操作</h2>

<p>首先我们来学习对 Mnesia 表读写的脏操作方式。一般情况下，我们都不会使用脏操作，因为脏操作并不一定保证成功，但是它可以帮助我们学习和适应 Mnesia 的使用方式。下面让我们往 <strong>Person</strong> 表中添加一些记录。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"Seymour Skinner"</span><span class="p">,</span> <span class="s2">"Principal"</span><span class="p">})</span>
<span class="ss">:ok</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"Homer Simpson"</span><span class="p">,</span> <span class="s2">"Safety Inspector"</span><span class="p">})</span>
<span class="ss">:ok</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"Moe Szyslak"</span><span class="p">,</span> <span class="s2">"Bartender"</span><span class="p">})</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>…然后我们可以通过 <code class="highlighter-rouge">Mnesia.dirty_read/1</code> 来读取数据：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_read</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span>
<span class="p">[{</span><span class="no">Person</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"Seymour Skinner"</span><span class="p">,</span> <span class="s2">"Principal"</span><span class="p">}]</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_read</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">2</span><span class="p">})</span>
<span class="p">[{</span><span class="no">Person</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"Homer Simpson"</span><span class="p">,</span> <span class="s2">"Safety Inspector"</span><span class="p">}]</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_read</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">3</span><span class="p">})</span>
<span class="p">[{</span><span class="no">Person</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"Moe Szyslak"</span><span class="p">,</span> <span class="s2">"Bartender"</span><span class="p">}]</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">dirty_read</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">4</span><span class="p">})</span>
<span class="p">[]</span>
</code></pre></div></div>

<p>如果我们查询的记录不存在时，Mnesia 会返回一个空的列表。</p>

<h2 id="事务transaction">事务（Transaction）</h2>

<p>我们一般会把我们对数据库的读写包在一个数据库事务里面。对事务的支持对设计容错系统和分布式系统非常重要。Mnesia 的事务是通过对数据库的多个操作包含到一个函数体中来实现。首先我们创建一个匿名函数，如此例中的 <code class="highlighter-rouge">data_to_write</code>，然后把这个函数传给 <code class="highlighter-rouge">Mnesia.transaction</code>。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">data_to_write</span> <span class="o">=</span> <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>   <span class="no">Mnesia</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">"Marge Simpson"</span><span class="p">,</span> <span class="s2">"home maker"</span><span class="p">})</span>
<span class="o">...&gt;</span>   <span class="no">Mnesia</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">"Hans Moleman"</span><span class="p">,</span> <span class="s2">"unknown"</span><span class="p">})</span>
<span class="o">...&gt;</span>   <span class="no">Mnesia</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">"Monty Burns"</span><span class="p">,</span> <span class="s2">"Businessman"</span><span class="p">})</span>
<span class="o">...&gt;</span>   <span class="no">Mnesia</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"Waylon Smithers"</span><span class="p">,</span> <span class="s2">"Executive assistant"</span><span class="p">})</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="c1">#Function&lt;20.54118792/0 in :erl_eval.expr/5&gt;</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="n">data_to_write</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">}</span>
</code></pre></div></div>

<p>从 IEx 中打印的消息来看，我们可以安全地假设数据已经被成功地写进了 <code class="highlighter-rouge">Person</code> 表。我们来验证一下使用事务从数据库里面读出刚刚写入的数据。我们可以用 <code class="highlighter-rouge">Mnesia.read/1</code> 来从数据库里面读取数据，同样的，我们也需要使用一个匿名函数。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">data_to_read</span> <span class="o">=</span> <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>   <span class="no">Mnesia</span><span class="o">.</span><span class="n">read</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">6</span><span class="p">})</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="c1">#Function&lt;20.54118792/0 in :erl_eval.expr/5&gt;</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="n">data_to_read</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="p">[{</span><span class="no">Person</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">"Monty Burns"</span><span class="p">,</span> <span class="s2">"Businessman"</span><span class="p">}]}</span>
</code></pre></div></div>

<p>如果你想要更新数据，你还是调用 <code class="highlighter-rouge">Mnesia.write/1</code>，只要记录里面的 key 和现有记录的 key 相同即可。要更新 Hans 那条记录的话，可以这样做：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span>
<span class="o">...&gt;</span>   <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="no">Mnesia</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">"Hans Moleman"</span><span class="p">,</span> <span class="s2">"Ex-Mayor"</span><span class="p">})</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="p">)</span>
</code></pre></div></div>

<h2 id="使用索引">使用索引</h2>

<p>Mnesia 也支持在非主键字段上添加索引，然后通过这个索引来查询数据。我们来试下在 <code class="highlighter-rouge">Person</code> 表的 <code class="highlighter-rouge">:job</code> 字段上添加索引：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">add_table_index</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:job</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">}</span>
</code></pre></div></div>

<p>结果跟 <code class="highlighter-rouge">Mnesia.create_table/2</code> 返回的相同：</p>

<ul>
  <li><code class="highlighter-rouge">{:atomic, :ok}</code> 表示执行成功</li>
  <li><code class="highlighter-rouge">{:aborted, Reason}</code> 表示执行失败</li>
</ul>

<p>类似的，如果索引已经存在，返回结果中的 <code class="highlighter-rouge">Reason</code> 为 <code class="highlighter-rouge">{:already_exists, table, attribute_index}</code>。所以当我们再执行一次上面的命令是，我们会得到下面的结果：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">add_table_index</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:job</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:aborted</span><span class="p">,</span> <span class="p">{</span><span class="ss">:already_exists</span><span class="p">,</span> <span class="no">Person</span><span class="p">,</span> <span class="mi">4</span><span class="p">}}</span>
</code></pre></div></div>

<p>创建索引成功后，我们可以通过索引来获取数据。下面的例子中使用 <code class="highlighter-rouge">Mnesia.index_read/2</code> 来获取工作是 <code class="highlighter-rouge">Principal</code> 的记录：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span>
<span class="o">...&gt;</span>   <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="no">Mnesia</span><span class="o">.</span><span class="n">index_read</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="s2">"Principal"</span><span class="p">,</span> <span class="ss">:job</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="p">)</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="p">[{</span><span class="no">Person</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"Seymour Skinner"</span><span class="p">,</span> <span class="s2">"Principal"</span><span class="p">}]}</span>
</code></pre></div></div>

<h2 id="匹配和选择">匹配和选择</h2>

<p>Mnesia支持复杂查询，以匹配和临时选择函数的形式从表中检索数据。</p>

<p><code class="highlighter-rouge">Mnesia.match_object/1</code> 函数可以通过模式匹配取回所有匹配的记录。如果有为任何一个字段添加索引的话，查询的效率会更高。不想某个字段参与匹配的话，可以用一个特殊的原子 <code class="highlighter-rouge">:_</code> 来替代。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span>
<span class="o">...&gt;</span>   <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="no">Mnesia</span><span class="o">.</span><span class="n">match_object</span><span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:_</span><span class="p">,</span> <span class="s2">"Marge Simpson"</span><span class="p">,</span> <span class="ss">:_</span><span class="p">})</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="p">)</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="p">[{</span><span class="no">Person</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">"Marge Simpson"</span><span class="p">,</span> <span class="s2">"home maker"</span><span class="p">}]}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Mnesia.select/2</code> 函数允许我们通过一个查询函数来查询数据。下面的例子是选择所有 key 大于 3 的记录：</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span>
<span class="o">...&gt;</span>   <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="no">Mnesia</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="p">[{{</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:"$1"</span><span class="p">,</span> <span class="ss">:"$2"</span><span class="p">,</span> <span class="ss">:"$3"</span><span class="p">},</span> <span class="p">[{</span><span class="ss">:&gt;</span><span class="p">,</span> <span class="ss">:"$1"</span><span class="p">,</span> <span class="mi">3</span><span class="p">}],</span> <span class="p">[</span><span class="ss">:"$$"</span><span class="p">]}])</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="p">)</span>
<span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="p">[[</span><span class="mi">7</span><span class="p">,</span> <span class="s2">"Waylon Smithers"</span><span class="p">,</span> <span class="s2">"Executive assistant"</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"Marge Simpson"</span><span class="p">,</span> <span class="s2">"home maker"</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="s2">"Monty Burns"</span><span class="p">,</span> <span class="s2">"Businessman"</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"Hans Moleman"</span><span class="p">,</span> <span class="s2">"unknown"</span><span class="p">]]}</span>
</code></pre></div></div>

<p>让我们来仔细看上面的例子。第一个参数是表名，<code class="highlighter-rouge">Person</code>，第二个参数是 <code class="highlighter-rouge">{match, [guard], [result]}</code>这样的形式：</p>

<ul>
  <li><code class="highlighter-rouge">match</code> 跟你传给 <code class="highlighter-rouge">Mnesia.match_object/1</code> 函数的那个参数一样；但是请注意那个特别的原子<code class="highlighter-rouge">:"$n"</code>是用来指定后面部分的参数位置。</li>
  <li><code class="highlighter-rouge">guard</code> 列表里面包含了你想要应用的过滤函数和这个函数的参数的元组。在本例中， 是由内置函数 <code class="highlighter-rouge">:&gt;</code> , 位置参数 <code class="highlighter-rouge">:$1</code>以及常数 <code class="highlighter-rouge">3</code> 组成。</li>
  <li><code class="highlighter-rouge">result</code> 列表是你希望查询返回的结果的字段的列表。<code class="highlighter-rouge">:"$$"</code> 用来表示返回所有字段，你也可以用 <code class="highlighter-rouge">[:"$1", :"$2"]</code> 来返回头两个字段。</li>
</ul>

<p>更多的信息请参考 Erlang 的<a href="http://erlang.org/doc/man/mnesia.html#select-2">官方文档</a>.</p>

<h2 id="数据初始化和迁移">数据初始化和迁移</h2>

<p>不管是什么软件解决方案，都会碰到需要更新你的系统并且迁移你数据库里的数据的时候。比方说，你在你的系统的第二版中需要往 <code class="highlighter-rouge">Person</code> 表中添加一个 <code class="highlighter-rouge">:age</code> 字段。我们不能再重新创建一个 <code class="highlighter-rouge">Person</code> 表了，但是我们可以改造这张表，我们还需要知道什么时候需要更改表。要实现这个，我们可以用 <code class="highlighter-rouge">Mnesia.table_info/2</code> 函数获取现在的表结构，以及通过 <code class="highlighter-rouge">Mnesia.transform_table/3</code> 函数来改变表结构。</p>

<p>在下面的代码中，我们要实现这些逻辑：</p>

<ul>
  <li>创建 v2 的表结构，包括这些属性： <code class="highlighter-rouge">[:id, :name, :job, :age]</code></li>
  <li>根据建表函数的返回结果分别处理：
    <ul>
      <li><code class="highlighter-rouge">{:atomic, :ok}</code>: 为 <code class="highlighter-rouge">Person</code> 表的 <code class="highlighter-rouge">:job</code> 和 <code class="highlighter-rouge">:age</code> 字段添加索引</li>
      <li><code class="highlighter-rouge">{:aborted, {:already_exists, Person}}</code>: 检查现有的字段并且做相应的处理：
        <ul>
          <li>如果是 v1 的字段列表 (<code class="highlighter-rouge">[:id, :name, :job]</code>)，改造表结构，给所有人的年龄设为 21 并且在 <code class="highlighter-rouge">:age</code> 上添加索引</li>
          <li>如果已经是我们想要的 v2 的字段列表，则无需做任何处理</li>
          <li>如果是其他情况，则返回错误</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>如果我们在用 <code class="highlighter-rouge">Mnesia.start/0</code> 启动 Mnesia 后马上对现有的表进行任何操作的话，那些表可能还没有初始化，并且无法访问。在这样的情况下，我们应该使用 <a href="http://erlang.org/doc/man/mnesia.html#wait_for_tables-2"><code class="highlighter-rouge">Mnesia.wait_for_tables/2</code></a> 函数。它会挂起当前的进程，直到数据库表初始化完毕，或者超时。</p>

<p><code class="highlighter-rouge">Mnesia.transform_table/3</code> 函数接受的参数列表为，表名和一个把旧的数据格式转换为新的数据格式的函数。</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="p">[</span><span class="ss">attributes:</span> <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:job</span><span class="p">,</span> <span class="ss">:age</span><span class="p">]])</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:atomic</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">}</span> <span class="o">-&gt;</span>
    <span class="no">Mnesia</span><span class="o">.</span><span class="n">add_table_index</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:job</span><span class="p">)</span>
    <span class="no">Mnesia</span><span class="o">.</span><span class="n">add_table_index</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:age</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:aborted</span><span class="p">,</span> <span class="p">{</span><span class="ss">:already_exists</span><span class="p">,</span> <span class="no">Person</span><span class="p">}}</span> <span class="o">-&gt;</span>
    <span class="k">case</span> <span class="no">Mnesia</span><span class="o">.</span><span class="n">table_info</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:attributes</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:job</span><span class="p">]</span> <span class="o">-&gt;</span>
        <span class="no">Mnesia</span><span class="o">.</span><span class="n">wait_for_tables</span><span class="p">([</span><span class="no">Person</span><span class="p">],</span> <span class="mi">5000</span><span class="p">)</span>
        <span class="no">Mnesia</span><span class="o">.</span><span class="n">transform_table</span><span class="p">(</span>
          <span class="no">Person</span><span class="p">,</span>
          <span class="k">fn</span> <span class="p">({</span><span class="no">Person</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">job</span><span class="p">})</span> <span class="o">-&gt;</span>
            <span class="p">{</span><span class="no">Person</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="mi">21</span><span class="p">}</span>
          <span class="k">end</span><span class="p">,</span>
          <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:job</span><span class="p">,</span> <span class="ss">:age</span><span class="p">]</span>
          <span class="p">)</span>
        <span class="no">Mnesia</span><span class="o">.</span><span class="n">add_table_index</span><span class="p">(</span><span class="no">Person</span><span class="p">,</span> <span class="ss">:age</span><span class="p">)</span>
      <span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:job</span><span class="p">,</span> <span class="ss">:age</span><span class="p">]</span> <span class="o">-&gt;</span>
        <span class="ss">:ok</span>
      <span class="n">other</span> <span class="o">-&gt;</span>
        <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">other</span><span class="p">}</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

    
    <blockquote class="edit-lesson">    
      Caught a mistake or want to contribute to the lesson?
      <a href="https://github.com/elixirschool/elixirschool/edit/master/zh-hans/lessons/specifics/mnesia.md" target="_blank" rel="noopener">
        Edit this page on GitHub!
      </a>
    </blockquote>
  </div>
</section>



<section>

<div class="row">
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/zh-hans/lessons/specifics/ets/" title="Erlang 项式存储 (ETS)">← Erlang 项式存储 (ETS)</a>
    </div>
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/zh-hans/lessons/specifics/debugging/" title="调试">调试 →</a>
    </div>
    
</div>
</section>




				</div>
			</div>
			<!-- Sidebar -->
  <div id="sidebar">
    <p class="toggle-theme-wrapper"><a rel="noopener" href="#toggle-theme" class="toggle-theme icon fas fa-circle-o" alt="Toggle Theme" title="Toggle Theme"></a></p>

    <div class="inner">
      
<!-- Locales Section -->
<section id="search" class="alt">
  <div id="locales">

      
        
        

        
          <a href="/en/lessons/specifics/mnesia/" title="English">en</a>
        
      
        
        

        
          <a href="/es/lessons/specifics/mnesia/" title="Español">es</a>
        
      
        
        

        
          <a href="/gr/lessons/specifics/mnesia/" >gr</a>
        
      
        
        

        
          <a href="/id/lessons/specifics/mnesia/" title="Bahasa Indonesia">id</a>
        
      
        
        

        
          <a href="/ko/lessons/specifics/mnesia/" >ko</a>
        
      
        
        

        
          <a href="/pl/lessons/specifics/mnesia/" >pl</a>
        
      
        
        

        
          <a href="/pt/lessons/specifics/mnesia/" >pt</a>
        
      
        
        

        
          <a href="/ru/lessons/specifics/mnesia/" title="Русский">ru</a>
        
      
        
        

        
          <a href="/th/lessons/specifics/mnesia/" title="ภาษาไทย">th</a>
        
      
        
        

        
          <a href="/vi/lessons/specifics/mnesia/" >vi</a>
        
      
        
        

        
          <strong >zh-hans</strong>
        
      
        
        

        
          <a href="/zh-hant/lessons/specifics/mnesia/" >zh-hant</a>
        
      

  </div>
</section>


      
<!-- Menu -->
<nav id="menu">
  <span class="stack-info otp-version">Elixir 1.10.1 - Erlang/OTP 22.0 [erts-10.5.3]</span>
  <header class="major">
    <h2>Menu</h2>
    <p>Elixir 编程语言教程</p>
  </header>
  <ul>
    <li>
      <a href="/zh-hans/" class=" up ">Home</a>
    </li>
  
    
    
    
    
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">基础</span>
          <ul>
        
            <li>
              
              <a href="/zh-hans/lessons/basics/basics/">1. 基础</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/collections/">2. 集合</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/enum/">3. Enum 模块</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/pattern-matching/">4. 模式匹配</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/control-structures/">5. 控制语句</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/functions/">6. 函数</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/pipe-operator/">7. 管道操作符</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/modules/">8. 模块（Module）</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/mix/">9. Mix</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/sigils/">10. 魔符(Sigil)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/documentation/">11. 文档模块</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/testing/">12. 测试</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/comprehensions/">13. 推导</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/strings/">14. 字符串</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/date-time/">15. 日期和时间</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/mix-tasks/">16. 自定义 Mix 任务</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/basics/iex-helpers/">17. IEx 辅助函数</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">高级</span>
          <ul>
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/erlang/">1. 和 Erlang 互操作</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/error-handling/">2. 错误处理</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/escripts/">3. 可执行文件</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/concurrency/">4. 并发</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/otp-concurrency/">5. OTP 并发</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/otp-supervisors/">6. OTP Supervisors</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/otp-distribution/">7. OTP 分布式</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/metaprogramming/">8. 元编程</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/umbrella-projects/">9. Umbrella Projects</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/typespec/">10. Specifications and types</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/behaviours/">11. 行为</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/gen-stage/">12. GenStage</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/advanced/protocols/">13. 协议</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Ecto</span>
          <ul>
        
            <li>
              
              <a href="/zh-hans/lessons/ecto/basics/">1. Basics</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/ecto/changesets/">2. Changesets</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/ecto/associations/">3. 关联关系</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/ecto/querying/">4. 查询</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener active up">专题</span>
          <ul>
        
            <li>
              
              <a href="/zh-hans/lessons/specifics/plug/">1. Plug</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/specifics/eex/">2. 嵌入的 Elixir (EEx)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/specifics/ets/">3. Erlang 项式存储 (ETS)</a>
              
            </li>
        
      
        
            <li>
              
              <span class="active">4. Mnesia 数据库</span>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/specifics/debugging/">5. 调试</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/specifics/nerves/">6. Nerves</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">程序库</span>
          <ul>
        
            <li>
              
              <a href="/zh-hans/lessons/libraries/guardian/">1. Guardian（基础）</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/libraries/poolboy/">2. Poolboy</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/libraries/benchee/">3. Benchee</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/libraries/bypass/">4. Bypass</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/libraries/distillery/">5. Distillery (基础)</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/zh-hans/lessons/libraries/stream-data/">6. StreamData</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    <li>
      <a href="/blog/" class=" up ">Blog</a>
    </li>
    
    <li>
      <a href="/zh-hans/report/" class=" up ">Translation Report</a>
    </li>
    
    <li>
      <a href="/contributors/" class=" up ">Contributors</a>
    </li>
  </ul>
</nav>

      <!-- Footer -->
      <footer id="footer">
        <p class="copyright">&copy; 2021 <a target="_blank" rel="noopener" href="https://github.com/doomspork">Sean Callan</a> All rights reserved.</p>
      </footer>
    </div>
  </div>

		</div>
		<!-- Scripts -->

    <script async="" src="/assets/main-f8c201d2721dcb6d1d4f6acb0ebd2b2c192757ed29271f519513e4417e347611.js" type="text/javascript"></script>
		<!--[if lte IE 8]><script async="" src="/assets/ie/respond.min-8306093ccce666c01dab405fac0d16596a1d1cf38aa0ba919d4831261662cdbb.js" type="text/javascript"></script><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	</body>
</html>
