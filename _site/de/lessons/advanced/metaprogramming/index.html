<!DOCTYPE HTML>



<html lang="de">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta name="description" content="Übungen zur Programmiersprache Elixir">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="http://localhost:4000/de/lessons/advanced/metaprogramming/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="Elixir School">
  <meta property="og:locale" content="de">
  <meta property="og:description" content="Übungen zur Programmiersprache Elixir">
  <meta property="og:image" content="http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg">
  
  
    
    
    
    
      <link rel="alternate" hreflang="de" href="/de/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="en" href="/en/lessons/advanced/metaprogramming/" />
      <link rel="alternate" hreflang="x-default" href="/en/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="es" href="/es/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="el" href="/gr/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="id" href="/id/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ja" href="/ja/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ko" href="/ko/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pl" href="/pl/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="pt" href="/pt/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="ru" href="/ru/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="vi" href="/vi/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hans" href="/zh-hans/lessons/advanced/metaprogramming/" />
    
  
    
    
    
    
      <link rel="alternate" hreflang="zh-hant" href="/zh-hant/lessons/advanced/metaprogramming/" />
    
  

  <link rel="canonical" href="http://localhost:4000/de/lessons/advanced/metaprogramming/">
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/assets/favicons/apple-touch-icon-06ad80501b5734bba0428ca0fc14fcbe45811a144914f7be78cdab3c3ea25458.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/assets/favicons/favicon-32x32-6e7b9eca57d29d185a5184e844c1372ce9da0a71f373f89b80ff11f120b01678.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/assets/favicons/favicon-16x16-789b56195138252cac40cf7f2425b6fcb4e71c3084abc8525781188781b958d3.png">
  <link rel="manifest" href="http://localhost:4000/manifest.json">
  <link rel="shortcut icon" href="http://localhost:4000/assets/favicons/favicon-8e1fdc2a44d6344b9871b3ecf53a803903891f82a602a3f59c65eda40f2b77b0.ico">
  <link rel="alternate" type="application/rss+xml" title="Elixir School" href="https://elixirschool.com/feed.xml" />
  <meta name="msapplication-config" content="http://localhost:4000/assets/favicons/browserconfig-e66282a6754e6899f9a53c6ebfe120749630242b741deb65f364abc297ccbc96.xml">
  <meta name="theme-color" content="#ffffff">

  
  
  <title>Metaprogrammierung &middot; Elixir School</title>
  <!-- CSS -->
  <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="stylesheet" type="text/css" href="/assets/main-07a5a32c1a26652d2bb0e43b4c7ade37f20599a76cae3c1e871d3af53cff80b2.css">
  <!--[if lte IE 9]><link rel="stylesheet" type="text/css" href="/assets/ie9-0c07c3ea146a3dd5dce4effda97b3718824cab9c30149877c0e445edecfdee60.css"><![endif]-->
  <!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/assets/ie8-f0c85ce6ad95a6d33929cb969a44f41a5e96ecb22de55f55d0f3c83cfc0012fc.css"><![endif]-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>
  <script type="text/javascript">
    if ("serviceWorker" in navigator) {
      if (!navigator.serviceWorker.controller) {
        navigator.serviceWorker.register("http://localhost:4000/serviceworker.js", {
          scope: "http://localhost:4000"
        })
        .then(reg => console.log("Service worker has been registered for scope: ", reg.scope))
        .catch(error => console.log("Service worker registration has failed: ", error));
      }
    }  
  </script>
</head>

	<body class="is-loading">
    <script type="text/javascript">
    var $theme = localStorage.getItem('theme');
    if ($theme === 'dark') document.body.classList.add("dark");
    </script>
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
					  <a href="/de/" class="logo"><strong>Elixir School</strong></a>
					  <ul class="icons">
  
  <li><iframe src="https://ghbtns.com/github-btn.html?user=elixirschool&repo=elixirschool&type=star&count=true" height="20" title="GitHub Stars" width="93" style="vertical-align: sub;"></iframe></li>
  <li><a target="_blank" rel="noopener" title="RSS" href="https://elixirschool.com/feed.xml" class="icon fa-rss-square"><span class="label">RSS</span></a></li>
  <li><a target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/de/lessons/advanced/metaprogramming/&title=Metaprogrammierung&summary=description&source=http://localhost:4000" class="icon fa-linkedin"><span class="label">Linkedin</span></a></li>
  <li><a target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/intent/tweet?url=http://localhost:4000/de/lessons/advanced/metaprogramming/&via=elixirschool&text=ElixirSchool: Metaprogrammierung&hashtags=learnelixir%2Celixirlang&" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
  <li><a target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/de/lessons/advanced/metaprogramming/" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
  <li><a target="_blank" rel="noopener" title="Pinterest" href="https://www.pinterest.com/pin/create/link/?url=http://localhost:4000/de/lessons/advanced/metaprogramming/&media=http://localhost:4000/assets/og_image-fad975b316dea5dc361d199bdfaa076006da49a0a3296f799aa7217b4c8b0cbe.jpg&description=ElixirSchool: Metaprogrammierung" class="icon fa-pinterest"><span class="label">Pinterest</span></a></li>
  <li><a target="_blank" rel="noopener" title="VK" href="https://vk.com/share.php?url=http://localhost:4000/de/lessons/advanced/metaprogramming/&title=ElixirSchool: Metaprogrammierung&description=Check out 'Metaprogrammierung' on ElixirSchool" class="icon fa-vk"><span class="label">VK</span></a></li>
  <li><a target="_blank" rel="noopener" title="Email" href="mailto:?to=&subject=ElixirSchool: Metaprogrammierung&body=Check out 'Metaprogrammierung' on ElixirSchool%0D%0A%0D%0Ahttp://localhost:4000/de/lessons/advanced/metaprogramming/" class="icon fa-envelope"><span class="label">Email</span></a></li>
  <li><a title="Print" href="javascript:window.print()" class="icon fa-print"><span class="label">Print</span></a></li>
</ul>

					</header>
					<section id="section-page" class="ltr">
  <header class="main">
    
    <h1 class="page-title">
  <span class="version-difference-indicator version-difference-major"></span>
  Metaprogrammierung
</h1>
<div class="version-info version-info-major">
  <span>
    
      Teile dieser Übersetzung könnten veraltet sein.<br/>
    

    Einige größere Änderungen wurden der originalen Lektion seit der letzten Aktualisierung hinzugefügt.
  </span>
</div>

    
  </header>
  <div class="content">
    <p>Metaprogrammierung ist die Vorgehensweise Code zu benutzen, um Code zu schreiben. In Elixir gibt uns das die Möglichkeit die Sprache zu erweitern, so dass sie unseren Anforderungen eher entspricht und dynamisch den Code zu verändern. Wir starten mit einem Blick darauf, wie Elixir unter der Haube repräsentiert wird; dann wie man es verändert und schlussendlich können wir dieses Wissen dazu nutzen, um es zu erweitern.</p>

<p>Vorsicht: Metaprogrammierung ist kniffelig und sollte nur falls wirklich notwendig eingesetzt werden. Zuviel benutzt wird sie unweigerlich zu komplexem Code führen, der schwierig zu verstehen und debuggen ist.</p>

<h2>Inhaltsverzeichnis</h2>
<div id="toc"></div>

<h2 id="quote">Quote</h2>

<p>Der erste Schritt für Metaprogrammierung ist zu verstehen, wie Ausdrücke repräsentiert werden. In Elixir besteht der abstract syntax tree (AST), die interne Repräsentation unseres Codes, aus Tupeln. Diese Tupel beinhalten drei Teile: Funktionsname, Metadaten und Funktionsargumente.</p>

<p>Um diese internen Strukturen zu betrachen, bietet uns Elixir die Funktion <code class="highlighter-rouge">quote/2</code>. Mit <code class="highlighter-rouge">quote/2</code> können wir Elixir Code in die darunterliegende Repräsentation verwandeln:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="mi">42</span>
<span class="mi">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"Hello"</span>
<span class="s2">"Hello"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="ss">:world</span>
<span class="ss">:world</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
<span class="p">{</span><span class="ss">:+</span><span class="p">,</span> <span class="p">[</span><span class="ss">context:</span> <span class="no">Elixir</span><span class="p">,</span> <span class="kn">import</span><span class="p">:</span> <span class="no">Kernel</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="k">if</span> <span class="n">value</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"True"</span><span class="p">,</span> <span class="k">else</span><span class="p">:</span> <span class="s2">"False"</span>
<span class="p">{</span><span class="ss">:if</span><span class="p">,</span> <span class="p">[</span><span class="ss">context:</span> <span class="no">Elixir</span><span class="p">,</span> <span class="kn">import</span><span class="p">:</span> <span class="no">Kernel</span><span class="p">],</span>
 <span class="p">[{</span><span class="ss">:value</span><span class="p">,</span> <span class="p">[],</span> <span class="no">Elixir</span><span class="p">},</span> <span class="p">[</span><span class="k">do</span><span class="p">:</span> <span class="s2">"True"</span><span class="p">,</span> <span class="k">else</span><span class="p">:</span> <span class="s2">"False"</span><span class="p">]]}</span>
</code></pre></div></div>

<p>Ist dir aufgefallen, dass die ersten drei Aufrufe keine Tupel zurück gegeben haben? Es gibt fünf Literale, die sich selbst zurück geben, falls sie gequoted werden:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:atom</span>
<span class="ss">:atom</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"string"</span>
<span class="s2">"string"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="c1"># All numbers</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># Lists</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="s2">"hello"</span><span class="p">,</span> <span class="ss">:world</span><span class="p">}</span> <span class="c1"># 2 element tuples</span>
<span class="p">{</span><span class="s2">"hello"</span><span class="p">,</span> <span class="ss">:world</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="unquote">Unquote</h2>

<p>Nun, da wir jetzt die interne Struktur unseres Codes erhalten können, wie verändern wir sie? Um neuen Code oder auch Werte zu injecten benutzen wir <code class="highlighter-rouge">unquote/1</code>. Wenn wir einen Ausdruck unquoten, wird er ausgewertet und in den AST injected. Um <code class="highlighter-rouge">unquote/1</code> zu demonstrieren, lass uns ein paar Beispiele anschauen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">2</span>
<span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">divide</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:divide</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="p">{</span><span class="ss">:denominator</span><span class="p">,</span> <span class="p">[],</span> <span class="no">Elixir</span><span class="p">}]}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">divide</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">denominator</span><span class="p">))</span>
<span class="p">{</span><span class="ss">:divide</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
</code></pre></div></div>

<p>Im ersten Beispiel wird unsere Variable <code class="highlighter-rouge">denominator</code> gequoted, so dass der resultierende AST ein Tupel beinhaltet, um auf die Variable zugreifen zu können. Im <code class="highlighter-rouge">unquote/1</code>-Beispiel enthält der resultierende Code dagegen den Wert von <code class="highlighter-rouge">denominator</code>.</p>

<h2 id="makros">Makros</h2>

<p>Wenn wir erst mal <code class="highlighter-rouge">quote/2</code> und <code class="highlighter-rouge">unquote/1</code> verstanden haben, sind wir bereit dazu in Makros abzutauchen. Es ist wichtig sich zu merken, dass Makros wie jede Metaprogrammierung nur spärlich eingesetzt werden sollte.</p>

<p>In ihrer einfachsten Form sind Makros nur besondere Funktionen, die entworfen wurden, um einen gequoteten Ausdruck in unseren Anwendungscode zu injecten.  Stell dir vor, dass das Makro mit dem gequoteten Ausdruck ersetzt wird, anstatt wie eine Funktion aufgerufen zu werden. Mit Makros haben wir alles an der Hand, um Elixir zu erweitern und unserer Anwendung dynamisch Code hinzuzufügen.</p>

<p>Wir beginnen mit <code class="highlighter-rouge">defmacro/2</code> ein Makro zu definieren, welches, wie vieles in Elixir, selbst ein Makro ist (lass das erst mal ins Bewusstein dringen). Als Beispiel werden wir <code class="highlighter-rouge">unless</code> als Makro implementieren. Erinner dich daran, dass ein Makro einen gequoteten Ausdruck zurückgeben muss:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OurMacro</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="k">unless</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">block</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">!unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Lass uns unser Modul requiren und unser Makro benutzen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">OurMacro</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">OurMacro</span><span class="o">.</span><span class="k">unless</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"Hi"</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">OurMacro</span><span class="o">.</span><span class="k">unless</span> <span class="no">false</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"Hi"</span>
<span class="s2">"Hi"</span>
</code></pre></div></div>

<p>Da Makros Code in unserer Anwendung ersetzen, können wir kontrollieren, was und wann etwas kompiliert wird. Ein Beispiel dafür kann im <code class="highlighter-rouge">Logger</code>-Modul gefunden werden. Wenn logging deaktiviert ist, wird kein Code injected und der so resultierende Code beinhaltet keine Referenzen oder Funktionsaufrufe auf logging. Das ist unterschiedlich zu anderen Sprachen, in denen das Overhead durch einen Funktionsaufruf darstellt, selbst wenn die Implementierung NOP ist.</p>

<p>Um dies zu demonstrieren, lass uns einen einfachen Logger erstellen, der entweder aktiviert oder deaktivert werden kann.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Logger</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="no">Application</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="ss">:logger</span><span class="p">,</span> <span class="ss">:enabled</span><span class="p">)</span> <span class="k">do</span>
      <span class="kn">quote</span> <span class="k">do</span>
        <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"Logged message: </span><span class="si">#{</span><span class="kn">unquote</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="kn">require</span> <span class="no">Logger</span>

  <span class="k">def</span> <span class="n">test</span> <span class="k">do</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"This is a log message"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Wenn logging aktiviert ist, würde unsere <code class="highlighter-rouge">test</code>-Funktion im Code etwa so aussehen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">test</span> <span class="k">do</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"Logged message: </span><span class="si">#{</span><span class="s2">"This is a log message"</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Wenn wir logging deaktivieren, sieht der resultierende Code so aus:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">test</span> <span class="k">do</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="debugging">Debugging</h2>

<p>Okay, jetzt wissen wir, wie man <code class="highlighter-rouge">quote/2</code> und <code class="highlighter-rouge">unquote/1</code> benutzt und Makros schreibt. Aber was, wenn du einen großen Haufen gequoteten Code hast und diesen verstehen möchtest? In diesem Fall kannst du <code class="highlighter-rouge">Macro.to_string/2</code> benutzen. Sieht dir dieses Beispiel an:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span><span class="p">(</span><span class="k">do</span><span class="p">:</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="s2">"foo.bar(1, 2, 3)"</span>
</code></pre></div></div>

<p>Wenn du den Code anschauen möchtest, der durch die Makros erzeugt wird, kannst du sie mit <code class="highlighter-rouge">Macro.expand/2</code> und <code class="highlighter-rouge">Macro.expand_once/2</code> kombinieren. Diese Funktionen dehnen Makros in ihren gequoteten Code aus. Die erste Funktion dehnt sie eventuell mehrere Male aus, während die letztere dies nur einmal macht. Lass uns zum Beispiel unser <code class="highlighter-rouge">unless</code>-Beispiel aus der vorherigen Sektion anschauen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OurMacro</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="k">unless</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">block</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">!unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="kn">require</span> <span class="no">OurMacro</span>

<span class="n">quoted</span> <span class="o">=</span>
  <span class="kn">quote</span> <span class="k">do</span>
    <span class="no">OurMacro</span><span class="o">.</span><span class="k">unless</span><span class="p">(</span><span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"Hi"</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">quoted</span> <span class="o">|&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">expand_once</span><span class="p">(</span><span class="n">__ENV__</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span> <span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span>
<span class="k">if</span><span class="p">(</span><span class="n">!true</span><span class="p">)</span> <span class="k">do</span>
  <span class="s2">"Hi"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Falls wir den selben Code mit <code class="highlighter-rouge">Macro.expand/2</code> aufrufen, ist es faszinierend:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">quoted</span> <span class="o">|&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">__ENV__</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span> <span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span>
<span class="k">case</span><span class="p">(</span><span class="n">!true</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">x</span> <span class="ow">when</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="no">false</span><span class="p">,</span> <span class="no">nil</span><span class="p">]</span> <span class="o">-&gt;</span>
    <span class="no">nil</span>
  <span class="n">_</span> <span class="o">-&gt;</span>
    <span class="s2">"Hi"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Du kannst dich vielleicht daran erinnern, dass wir erwähnt hatten, dass <code class="highlighter-rouge">if</code> ein Makro in Elixir ist. Hier sieht du es ausgedehnt, in die darunter liegende <code class="highlighter-rouge">case</code>-Aussage.</p>

<h3 id="private-makros">Private Makros</h3>

<p>Obwohl sie nicht so häufig sind, unterstützt Elixir private Makros. Ein privates Makro wird mit <code class="highlighter-rouge">defmacrop</code> definiert und kann nur innerhalb des Moduls aufgerufen werden, in dem es definiert wurde. Ein Privates Makro muss vor dem Code definiert werden, der es aufruft.</p>

<h3 id="makrohygiene">Makrohygiene</h3>

<p>In welcher Weise Makros mit dem Kontext des Aufrufers interagieren, nachdem sie ausgedehnt wurden, ist als Makrohygiene bekannt. Standardmäßig sind Makros in Elixir hygienisch und erzeugen keine Konflikte in unserem Kontext:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">hygienic</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Example</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">42</span>
<span class="mi">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">hygienic</span>
<span class="o">-</span><span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span>
<span class="mi">42</span>
</code></pre></div></div>

<p>Was, wenn wir den Wert von <code class="highlighter-rouge">val</code> manipulieren möchten? Um eine Variable as unhygienic zu markieren, können wir <code class="highlighter-rouge">var!/2</code> benutzen. Lass uns das obige Beispiel aktualisieren und ein anderes Makro mit <code class="highlighter-rouge">var!/2</code> benutzen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">hygienic</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">end</span>

  <span class="k">defmacro</span> <span class="n">unhygienic</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">var!</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Lass uns vergleichen, wie sie mit unserem Kontext umgehen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Example</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">42</span>
<span class="mi">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">hygienic</span>
<span class="o">-</span><span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span>
<span class="mi">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">unhygienic</span>
<span class="o">-</span><span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span>
<span class="o">-</span><span class="mi">1</span>
</code></pre></div></div>

<p>Indem wir <code class="highlighter-rouge">var!/2</code> in unser Makro inkludiert haben, können wir den Wert von <code class="highlighter-rouge">val</code> verändern, ohne ihn an das andere Makro zu übergeben. Der Gebrauch von unhygienischen Makros sollte auf ein Minimum reduziert werden. Durch das Inkludieren von <code class="highlighter-rouge">var!/2</code> erhöhen wir das Risiko eines Auflösungskonflikts einer Variablen.</p>

<h3 id="bindung">Bindung</h3>

<p>Wir haben bereits die Nützlichkeit von <code class="highlighter-rouge">unquote/1</code> besprochen, aber es gibt noch einen weiteren Weg Werte in unseren Code zu injecten: Bindung. Durch Variablenbindung ist es uns möglich mehrere Variablen in unser Makro zu inkludieren und sicherzustellen, dass sie nur einmal unquoted werden, um so versehentliche Neuevaluierung zu umgehen. Um gebundene Variablen zu benutzen, müssen wir der Option <code class="highlighter-rouge">bind_quoted</code> in <code class="highlighter-rouge">quote/2</code> eine Liste an Keywords übergeben.</p>

<p>Um den Vorteil von <code class="highlighter-rouge">bind_quote</code> zu sehen und das Problem mit Neuevaluierung zu demonstrieren lass uns ein Beispiel erstellen. Wir starten mit der Erstellung eines Makros, das einen Ausdruck zweimal ausgeben soll:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">double_puts</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Wir testen unser neu erstelltes Makro, indem wir ihm die aktuelle Systemzeit übergeben. Wir erwarten, diese zweimal ausgegeben zu sehen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">double_puts</span><span class="p">(</span><span class="ss">:os</span><span class="o">.</span><span class="n">system_time</span><span class="p">)</span>
<span class="mi">1450475941851668000</span>
<span class="mi">1450475941851733000</span>
</code></pre></div></div>

<p>Die Zeiten sind unterschiedlich! Was ist passiert? <code class="highlighter-rouge">unquote/1</code> mehrmals auf dem gleichen Ausdruck zu benutzen resultiert in Neuevaluierung, was unerwartete Konsequenzen bergen kann. Lass uns unser Beispiel so aktualisieren, dass es <code class="highlighter-rouge">bind_quoted</code> benutzt und dann nochmal sehen, was wir bekommen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">double_puts</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="ss">bind_quoted:</span> <span class="p">[</span><span class="ss">expr:</span> <span class="n">expr</span><span class="p">]</span> <span class="k">do</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Example</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">double_puts</span><span class="p">(</span><span class="ss">:os</span><span class="o">.</span><span class="n">system_time</span><span class="p">)</span>
<span class="mi">1450476083466500000</span>
<span class="mi">1450476083466500000</span>
</code></pre></div></div>

<p>Mit <code class="highlighter-rouge">bind_quoted</code> bekommen wir das Ergebnis, das wir erwartet haben: Dieselbe Zeit zweimal ausgegeben.</p>

<p>Nun, da wir <code class="highlighter-rouge">quote/2</code>, <code class="highlighter-rouge">unquote/1</code> und <code class="highlighter-rouge">defmacro/2</code> behandelt haben, haben wir all die notwendigen Werkzeuge, um Elixir auf unsere Bedürfnisse anzupassen.</p>

    
    <blockquote class="edit-lesson">    
      Caught a mistake or want to contribute to the lesson?
      <a href="https://github.com/elixirschool/elixirschool/edit/master/de/lessons/advanced/metaprogramming.md" target="_blank" rel="noopener">
        Edit this page on GitHub!
      </a>
    </blockquote>
  </div>
</section>



<section>

<div class="row">
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/de/lessons/advanced/otp-supervisors/" title="OTP Supervisors">← OTP Supervisors</a>
    </div>
    
    
    
    <div class="6u 12u$(small)">
        <a class="button special fit" href="/de/lessons/advanced/umbrella-projects/" title="Umbrella-Projekte">Umbrella-Projekte →</a>
    </div>
    
</div>
</section>




				</div>
			</div>
			<!-- Sidebar -->
  <div id="sidebar">
    <p class="toggle-theme-wrapper"><a rel="noopener" href="#toggle-theme" class="toggle-theme icon fas fa-circle-o" alt="Toggle Theme" title="Toggle Theme"></a></p>

    <div class="inner">
      
<!-- Locales Section -->
<section id="search" class="alt">
  <div id="locales">

      
        
        

        
          <strong >de</strong>
        
      
        
        

        
          <a href="/en/lessons/advanced/metaprogramming/" title="English">en</a>
        
      
        
        

        
          <a href="/es/lessons/advanced/metaprogramming/" title="Español">es</a>
        
      
        
        

        
          <a href="/gr/lessons/advanced/metaprogramming/" >gr</a>
        
      
        
        

        
          <a href="/id/lessons/advanced/metaprogramming/" title="Bahasa Indonesia">id</a>
        
      
        
        

        
          <a href="/ja/lessons/advanced/metaprogramming/" title="日本語">ja</a>
        
      
        
        

        
          <a href="/ko/lessons/advanced/metaprogramming/" >ko</a>
        
      
        
        

        
          <a href="/pl/lessons/advanced/metaprogramming/" >pl</a>
        
      
        
        

        
          <a href="/pt/lessons/advanced/metaprogramming/" >pt</a>
        
      
        
        

        
          <a href="/ru/lessons/advanced/metaprogramming/" title="Русский">ru</a>
        
      
        
        

        
          <a href="/vi/lessons/advanced/metaprogramming/" >vi</a>
        
      
        
        

        
          <a href="/zh-hans/lessons/advanced/metaprogramming/" >zh-hans</a>
        
      
        
        

        
          <a href="/zh-hant/lessons/advanced/metaprogramming/" >zh-hant</a>
        
      

  </div>
</section>


      
<!-- Menu -->
<nav id="menu">
  <span class="stack-info otp-version">Elixir 1.10.1 - Erlang/OTP 22.0 [erts-10.5.3]</span>
  <header class="major">
    <h2>Menu</h2>
    <p>Übungen zur Programmiersprache Elixir</p>
  </header>
  <ul>
    <li>
      <a href="/de/" class=" up ">Home</a>
    </li>
  
    
    
    
    
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Grundlagen</span>
          <ul>
        
            <li>
              
              <a href="/de/lessons/basics/basics/">1. Grundlagen</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/collections/">2. Collections</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/enum/">3. Enums</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/pattern-matching/">4. Pattern Matching</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/control-structures/">5. Kontrollstrukturen</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/functions/">6. Funktionen</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/pipe-operator/">7. Pipe Operator</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/modules/">8. Module</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/mix/">9. Mix</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/sigils/">10. Sigils</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/documentation/">11. Dokumentation</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/testing/">12. Testen</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/comprehensions/">13. Comprehensions</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/strings/">14. Strings</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/mix-tasks/">16. Custom Mix Tasks</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/basics/iex-helpers/">17. IEx Hilfsfunktionen</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener active up">Erweitert</span>
          <ul>
        
            <li>
              
              <a href="/de/lessons/advanced/erlang/">1. Erlang-Interoperabilität</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/error-handling/">2. Fehlerbehandlung</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/escripts/">3. Ausführbare Dateien</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/concurrency/">4. Nebenläufigkeit</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/otp-concurrency/">5. OTP Nebenläufigkeit</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/otp-supervisors/">6. OTP Supervisors</a>
              
            </li>
        
      
        
            <li>
              
              <span class="active">8. Metaprogrammierung</span>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/umbrella-projects/">9. Umbrella-Projekte</a>
              
            </li>
        
      
        
            <li>
              
              <a href="/de/lessons/advanced/typespec/">10. Spezifikationen und Typen</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    
    
    
    
    
      
        
        <li>
          <span class="opener up">Einzelheiten</span>
          <ul>
        
            <li>
              
              <a href="/de/lessons/specifics/eex/">2. Embedded Elixir (EEx)</a>
              
            </li>
        
          </ul>
        </li>
        
      
    
  
    <li>
      <a href="/blog/" class=" up ">Blog</a>
    </li>
    
    <li>
      <a href="/de/report/" class=" up ">Translation Report</a>
    </li>
    
    <li>
      <a href="/contributors/" class=" up ">Contributors</a>
    </li>
  </ul>
</nav>

      <!-- Footer -->
      <footer id="footer">
        <p class="copyright">&copy; 2021 <a target="_blank" rel="noopener" href="https://github.com/doomspork">Sean Callan</a> All rights reserved.</p>
      </footer>
    </div>
  </div>

		</div>
		<!-- Scripts -->

    <script async="" src="/assets/main-f8c201d2721dcb6d1d4f6acb0ebd2b2c192757ed29271f519513e4417e347611.js" type="text/javascript"></script>
		<!--[if lte IE 8]><script async="" src="/assets/ie/respond.min-8306093ccce666c01dab405fac0d16596a1d1cf38aa0ba919d4831261662cdbb.js" type="text/javascript"></script><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	</body>
</html>
